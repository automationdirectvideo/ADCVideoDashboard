function createDescriptionReport(){const e=document.getElementById("status-text"),t=document.getElementById("loading-bar"),n=document.getElementById("loading-bar-container"),r=document.getElementById("view-report-button");return n.style.display="",t.style.width="0%",t.classList.add("progress-bar-animated"),e.style.display="",e.innerText="Fetching YouTube Videos...",r.style.display="none",getVideoList().then(n=>{const r=n[0];let o=[];for(const e in r)if(r.hasOwnProperty(e)){const t=r[e],n=t.privacy;"public"==n&&o.push(e)}let i=o.length;return t.ariaValueMax=i+Math.ceil(i/50),e.innerText="Retrieving Descriptions...",getAllDescriptions(o)}).then(t=>{e.innerText="Verifying Description Format...";let n=[];for(let e=0;e<t.length;e++){const r=t[e];n.push(checkFormat(r)),incrementLoadingBar()}return e.innerText="Generating Spreadsheet...",saveDescriptionsErrors(n)}).then(n=>{e.innerText="Finished!",t.classList.remove("progress-bar-animated"),r.style.display=""}).catch(t=>{e.innerText="Process Failed";const n="Error creating description report";displayError(n),console.error(n,t),recordError(t,n)})}function getAllDescriptions(e){let t=[];for(let n=0;n<e.length;n+=50){const r=e.slice(n,n+50),o=r.join(","),i={part:"snippet",id:o},s=gapi.client.youtube.videos.list(i).then(e=>{console.log("Video Request",e);let t=[];const n=e.result.items;for(let e=0;e<n.length;e++){const r=n[e],o=r.id,i=r.snippet.description;t.push({videoId:o,description:i})}return incrementLoadingBar(),t}).catch(e=>{const t="Error in fetching descriptions for video group"+` ${n} - ${n+49}: `;return displayError(t),console.error(t,e),recordError(e,t),t});t.push(s)}return Promise.all(t).then(e=>{const t=[].concat.apply([],e);return t})}function scanDescriptionsForLinks(e){let t={};for(let n=0;n<e.length;n++){const r=e[n],o=(r.videoId,r.description),i=searchForURLs(o);for(let e=0;e<i.length;e++){const n=i[e];null==t[n]?t[n]=1:t[n]+=1}}let n=[];for(const e in t)n.push([e,t[e]]);return n.sort(function(e,t){return t[1]-e[1]}),console.log(n),t}function saveDescriptionsErrors(e){const t=["Video ID","YouTube Link","(VID-**-****)","Subscribe Link","Facebook Link","Twitter Link","LinkedIn Link","'Prices Were Valid' Sentence","'Check out all videos' sentence"];e.unshift(t);const n={values:e},r=clearSpreadsheet("Reports","Description Format").then(e=>updateSheetData("Reports","Description Format",n));return r}function checkFormat(e){const t=e.videoId,n=e.description,r=`https://studio.youtube.com/video/${t}/edit`;let o=[t,r];return o.push(checkVID(n)),o.push(checkSocialLinks(n)),o.push(checkPricesWereValid(n)),o.push(checkAllVideoLink(n)),o=[].concat.apply([],o),o}function checkVID(e){const t=/\(VID-[a-zA-Z0-9]{2,3}-([0-9]{2}|[0-9]{4})\)/g,n=t.exec(e);return n?["Present"]:["MISSING"]}function checkSocialLinks(e){let t=[];const n=/https:\/\/www\.youtube\.com\/(user\/automationdirect\?sub_confirmation=1|subscription_center\?add_user=automationdirect)(?:\s|$)/g,r=n.exec(e);r?t.push("Present"):t.push("MISSING");const o=/https:\/\/www\.facebook\.com\/[aA]utomation[dD]irect(?:\s|$)/g,i=o.exec(e);i?t.push("Present"):t.push("MISSING");const s=/https:\/\/(?:www\.)?twitter\.com\/[aA]utomation[dD]irec(?:\s|$)/g,c=s.exec(e);c?t.push("Present"):t.push("MISSING");const a=/https:\/\/www\.linkedin\.com\/company\/automationdirect/,l=a.exec(e);return l?t.push("Present"):t.push("MISSING"),t}function checkPricesWereValid(e){const t="Prices were valid at the time the video was released and are subject to change";return-1===e.indexOf(t)?["MISSING"]:["Present"]}function checkAllVideoLink(e){const t=/Check out all of our videos at:? https:\/\/www\.[aA]utomation[dD]irect\.com\/[vV]ideos/,n=t.exec(e);return n?["Present"]:["MISSING"]}function incrementLoadingBar(){const e=document.getElementById("loading-bar");e.ariaValueNow++;const t=e.ariaValueNow,n=e.ariaValueMax,r=t/n*100,o=r.toFixed(2)+"%";e.style.width=o}function searchForURLs(e){const t=/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g;let n,r=[];do{n=t.exec(e),n&&r.push(n[0])}while(n);return r}function displayError(e){const t=document.getElementById("alert-container"),n=`\n    <div class="alert alert-danger alert-dismissible fade show mb-2" id="error-alert" role="alert" style="display:inline-block;">\n      <i class="fas fa-exclamation-triangle"></i>  <strong>An error occurred:</strong> ${e}\n      <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>`,r=createElement(n,"DIV");prependElement(t,r)}function loadSignedIn(){const e=document.getElementById("scan-button");e.disabled="",e.onclick=createDescriptionReport}function loadSignedOut(){createSignInModal();const e=document.getElementById("authorize-button");e.onclick=handleAuthClick,$("#signinModal").modal({backdrop:"static",keyboard:!1})}function findLinksForVideo(e){return requestVideoDescription(e).then(e=>{const t=searchForURLs(e);return t}).catch(t=>{const n="Error getting description links for video:"+` ${e} - `;displayError(n),console.error(n,t),recordError(t,n)})}function requestVideoDescription(e){const t={part:"snippet",id:e};return gapi.client.youtube.videos.list(t).then(t=>{console.log(`Video Description for video: ${e}`,t);const n=t.result.items[0].snippet.description;return n}).catch(t=>{const n="Error getting video description for video:"+` ${e} - `;displayError(n),console.error(n,t),recordError(t,n)})}