function createCommentsReport(){const e=document.getElementById("status-text"),t=document.getElementById("loading-bar"),n=document.getElementById("loading-bar-container"),o=document.getElementById("view-report-button");return n.style.display="",t.style.width="0%",t.classList.add("progress-bar-animated"),e.style.display="",e.innerText="Fetching YouTube Videos...",o.style.display="none",getVideoList().then(n=>{const o=n[1];return t.ariaValueMax=o.length,e.innerText="Retrieving Comments...",getAllComments(o)}).then(t=>(e.innerText="Generating Spreadsheet...",saveCommentsReport(t))).then(n=>{e.innerText="Finished!",t.classList.remove("progress-bar-animated"),o.style.display=""}).catch(t=>{e.innerText="Process Failed";const n="Error creating comments report";displayError(n),console.log(n,t),recordError(t,n)})}function getAllComments(e){let t=[];for(let n=0;n<e.length;n++){const o=e[n];t.push(getCommentsForVideo(o))}return Promise.all(t).then(e=>{const t=[].concat.apply([],e);return t}).catch(e=>{const t="Unable to combine all comment data into one array";displayError(t),console.error(t,e),recordError(e,t)})}function getCommentsForVideo(e,t){let n={maxResults:100,part:"snippet",textFormat:"plainText",videoId:e};t&&(n.pageToken=t);const o=`https://youtu.be/${e}`;return gapi.client.youtube.commentThreads.list(n).then(t=>{const n=t.result.items;let r=[];for(let t=0;t<n.length;t++){const a=n[t].snippet.topLevelComment.snippet,s=a.authorDisplayName,l=a.publishedAt,i=a.textDisplay,c=a.authorChannelId.value;"UCR5c2ZGLZY2FFbxZuSxzzJg"!=c&&r.push([e,o,s,l,i])}const a=t.result.nextPageToken;return a?getCommentsForVideo(e,a).then(e=>{let t=[].concat.apply([],[r,e]);return t}):(incrementLoadingBar(),r)}).catch(t=>{const n=`Unable to get comments for video: ${e}`;return displayError(n),console.error(n,t),recordError(t,n),[]})}function incrementLoadingBar(){const e=document.getElementById("loading-bar");e.ariaValueNow++;const t=e.ariaValueNow,n=e.ariaValueMax,o=t/n*100,r=o.toFixed(2)+"%";e.style.width=r}function saveCommentsReport(e){const t=["Video ID","YouTube Link","Comment Author","Published At","Comment"];e.unshift(t);const n={values:e},o=clearSpreadsheet("Reports","Comments").then(e=>updateSheetData("Reports","Comments",n));return o}function displayError(e){const t=document.getElementById("alert-container"),n=`\n    <div class="alert alert-danger alert-dismissible fade show mb-2" id="error-alert" role="alert" style="display:inline-block;">\n      <i class="fas fa-exclamation-triangle"></i>  <strong>An error occurred:</strong> ${e}\n      <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>`,o=createElement(n,"DIV");prependElement(t,o)}function loadSignedIn(){const e=document.getElementById("scan-button");e.disabled="",e.onclick=createCommentsReport}