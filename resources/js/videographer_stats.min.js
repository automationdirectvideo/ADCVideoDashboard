function loadSignedIn(){addDotsToLoadingText();const e=document.getElementById("home-button"),t=document.getElementById("control-panel-button");e.style.display="inline",t.style.display="inline",initializeUpdater(),loadDashboards(),updateTheme(0)}function loadSignedOut(){createSignInModal("dashboards");const e=document.getElementById("authorize-button");e.onclick=handleAuthClick,$("#signinModal").modal({backdrop:"static",keyboard:!1})}function loadDashboards(){if(!isLoading&&!isUpdating){setLoadingStatus(!0);const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(showLoadingText(),resetGraphData(),e){let e=lsGet("categoryStats");e?loadDashboardsSignedIn():getBasicDashboardStats().then(e=>{loadDashboardsSignedIn()})}}}function loadDashboardsSignedIn(){console.log("Starting Load Dashboards Requests");try{loadVideographerDashboards(),console.log("Load Dashboards Complete")}catch(e){const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}finally{setLoadingStatus(!1),hideLoadingText()}}function initializeUpdater(){let e=new Date;e.setHours(0,0,0,0);const t=gapi.auth2.getAuthInstance().isSignedIn.get();var a=window.setInterval(()=>{const a=new Date;let o=Math.floor((a-e)/1e3);t&&(3600==o?recordUpdate("Reload Dashboards").then(e=>{window.location.reload()}):o%900==0&&loadDashboards())},1e3);return a}function initializeCarousels(){const e=document.getElementById("videographer-carousel");e.setAttribute("data-ride","carousel"),e.setAttribute("data-interval",cycleSpeed),e.setAttribute("data-pause","false"),createVideographerStatsDashboards()}function updateDashboards(){if(!isLoading&&!isUpdating){setUpdatingStatus(!0),showUpdatingText();let e=[];return e.push(getVideographerViewsForCurrMonth()),e.push(updateVideoAndCategoryStats()),Promise.all(e).then(e=>(console.log("Update Dashboards Complete",e),recordUpdate("Dashboards Updated"),hideUpdatingText(),setUpdatingStatus(!1),loadDashboards())).catch(e=>{recordUpdate("Update Failed");const t="Error occurred updating dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{hideUpdatingText(),setUpdatingStatus(!1)})}}function loadVideographerDashboards(){try{let e=calcVideographerStats();displayVideographerMonthlyVideos(e);const t=requestVideographerAvgViews(e,getDateFromDaysAgo(34),getDateFromDaysAgo(4)).then(e=>{displayVideographerAvgViews(e)}).catch(e=>{const t=getDashboardGraphIds("videographerGraphs").avgViews;for(const e in t)if(t.hasOwnProperty(e)){const a=t[e];displayGraphError(a)}recordError(e,"Unable to display videographer average views graphs - ")}),a=getVideographerMonthlyViews(e).then(e=>{displayVideographerMonthlyViews(e)}).catch(e=>{const t=[getDashboardGraphIds("videographerGraphs").cumulativeViews,getDashboardGraphIds("videographerGraphs").monthlyViews];t.forEach(e=>{for(const t in e)if(e.hasOwnProperty(t)){const a=e[t];displayGraphError(a)}}),recordError(e,"Unable to display videographer monthly views graphs - ")}),o=requestVideographerEngagementStats(e,getDateFromDaysAgo(34),getDateFromDaysAgo(4)),s=requestVideographerEngagementStats(e);Promise.all([t,a,o,s]).then(e=>{displayVideographerStats(),saveVideographerStatsToSheets()})}catch(e){const t=[getDashboardGraphIds("videographerGraphs").avgViews,getDashboardGraphIds("videographerGraphs").cumulativeVideos,getDashboardGraphIds("videographerGraphs").cumulativeViews,getDashboardGraphIds("videographerGraphs").monthlyVideos,getDashboardGraphIds("videographerGraphs").monthlyViews];t.forEach(e=>{for(const t in e)if(e.hasOwnProperty(t)){const a=e[t];displayGraphError(a)}}),recordError(e,"Unable to load videographer dashboards")}}function createVideographerStatsDashboards(){const e=document.getElementById("videographer-carousel-inner"),t=document.getElementById("videographer-indicator-list"),a=["Shane C","Rick F","Tim W"],o={all:"All Videos",organic:"Organic Videos",notOrganic:"Not Organic Videos"};let s=e.childElementCount;a.forEach(a=>{const r="vstats-"+a.replace(" ","*"),i="vstats-overall-"+a.replace(" ","*");let n=document.getElementById("vstats-#").cloneNode(!0),d=n.outerHTML,l="",c="";for(const e in o)if(o.hasOwnProperty(e)){const t=o[e],s=document.getElementById("vstats-#-@-grid").cloneNode(!0);"all"==e&&s.classList.add("active-grid");let r=s.outerHTML;r=r.replace(/@/g,e),r=r.replace(/\*Name\*/g,a),r=r.replace(/\*Category\*/g,t),l+=r;const i=document.getElementById("vstats-overall-#-@-grid").cloneNode(!0);let n=i.outerHTML;n=n.replace(/@/g,e),n=n.replace(/\*Name\*/g,a),n=n.replace(/\*Category\*/g,t),c+=n}d=d.replace(/<div>MAIN GRID PLACEHOLDER<\/div>/,l),d=d.replace(/<div>OVERALL GRID PLACEHOLDER<\/div>/,c),d=d.replace(/vstats-#/g,r),d=d.replace(/vstats-overall-#/g,i);let h=document.createElement("template");h.innerHTML=d,n=h.content.firstChild,document.createElement("div",n.outerText),n.setAttribute("theme","light");const g=document.getElementById("indicator").cloneNode();g.id="videographer-indicator-"+s,g.setAttribute("onclick",`goToCarouselItem(${s})`),g.setAttribute("data-target","#videographer-carousel"),g.className="fas fa-play-circle indicator",e.appendChild(n),t.appendChild(g),s++})}function calcVideographerStats(){const e=lsGet("allVideoStats"),t=lsGet("statsByVideoId");let a={};for(let o=0;o<e.length;o++){const s=e[o],r=s.videoId,i=t[r].createdBy,n=t[r].organic;a[i]||(a[i]={all:{totalComments:0,totalDislikes:0,totalDuration:0,totalLikeRatio:0,totalLikes:0,totalSubsGained:0,totalViews:0,videos:[]},organic:{totalComments:0,totalDislikes:0,totalDuration:0,totalLikeRatio:0,totalLikes:0,totalSubsGained:0,totalViews:0,videos:[]},notOrganic:{totalComments:0,totalDislikes:0,totalDuration:0,totalLikeRatio:0,totalLikes:0,totalSubsGained:0,totalViews:0,videos:[]}});let d=[a[i].all];n?d.push(a[i].organic):d.push(a[i].notOrganic);const l=s.comments,c=s.dislikes,h=s.duration,g=s.likes/(s.likes+s.dislikes),p=s.likes,u=s.subscribersGained,m=s.views;d.forEach(e=>{e.totalComments+=l,e.totalDislikes+=c,e.totalDuration+=h,isNaN(g)||(e.totalLikeRatio+=g),e.totalLikes+=p,e.totalSubsGained+=u,e.totalViews+=m,e.videos.push(r)})}for(const e in a)if(a.hasOwnProperty(e)){const t=a[e];for(const e in t)if(t.hasOwnProperty(e)){const a=t[e];let o=a.videos.length;a.numVideos=o,0==o&&(o=1),a.avgComments=a.totalComments/o,a.avgDislikes=a.totalDislikes/o,a.avgDuration=a.totalDuration/o,a.avgLikeRatio=a.totalLikeRatio/o,a.avgLikes=a.totalLikes/o,a.avgSubsGained=a.totalSubsGained/o,a.avgViews=a.totalViews/o;let s=a.avgLikes/(a.avgLikes+a.avgDislikes);isNaN(s)&&(s=void 0),a.cumLikeRatio=s}}return a=calcVideographerVideosByMonth(a),lsSet("videographers",a),a}function calcVideographerVideosByMonth(e){const t=lsGet("statsByVideoId"),a=new Date,o=30;for(const s in e)if(e.hasOwnProperty(s)){const r=e[s];for(const e in r)if(r.hasOwnProperty(e)){const s=r[e];let i={},n=0;const d=s.videos;d.forEach(e=>{const s=t[e].publishDate,r=s.substr(0,7);null==i[r]&&(i[r]=0),i[r]+=1,a-new Date(s)<=864e5*o&&n++});const l=getMonthsSince(2010,7);l.forEach(e=>{null==i[e]&&(i[e]=0)}),s.monthlyVideos=i,s.numVideosLastXDays=n}}return e}function getVideographerMonthlyViews(){return requestSpreadsheetData("Stats","Videographer Monthly Views").then(e=>{const t=getColumnHeaders(e);let a={};e[0].forEach(e=>{"Month"!=e&&(a[e]={})});for(let o=1;o<e.length;o++){const s=e[o],r=s[t.Month];e[0].forEach(e=>{"Month"!=e&&(a[e][r]=parseInt(s[t[e]]))})}let o=lsGet("videographers");for(const e in a)if(a.hasOwnProperty(e)){const t=a[e],s=e.indexOf("-"),r=e.substring(0,s),i=e.substring(s+1);o[r][i].monthlyViews=t}return lsSet("videographers",o),o})}