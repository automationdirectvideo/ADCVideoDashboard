function loadSignedIn(){addDotsToLoadingText();const e=document.getElementById("signin-modal-button"),t=document.getElementById("signout-modal-button"),a=document.getElementById("control-panel-button");e.style.display="none",t.style.display="inline",a.style.display="inline",initializeUpdater(),loadDashboards(),updateTheme(0)}function loadSignedOut(){addDotsToLoadingText();const e=document.getElementById("signin-modal-button"),t=document.getElementById("signout-modal-button"),a=document.getElementById("control-panel-button");e.style.display="inline",t.style.display="none",a.style.display="none",initializeUpdater(),loadDashboards(),updateTheme(0)}function loadDashboards(){if(!isLoading&&!isUpdating){setLoadingStatus(!0);const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(showLoadingText(),resetGraphData(),e){let e=lsGet("categoryStats");e?loadDashboardsSignedIn():getBasicDashboardStats().then(e=>{loadDashboardsSignedIn()})}else loadDashboardsSignedOut()}}function loadDashboardsSignedIn(){const e=document.getElementsByClassName("carousel-inner")[0];let t=[];return e.children["intro-animation"]&&loadIntroAnimation(),e.children["video-strength"]&&loadVideoStrengthDashboard(),e.children["real-time-stats"]&&t.push(loadRealTimeStatsDashboard()),e.children.thumbnails&&t.push(loadThumbnailDashboard()),e.children.platform&&t.push(loadPlatformDashboard()),e.children["top-ten"]&&t.push(loadTopTenDashboard()),e.children.feedback&&t.push(loadUserFeedbackDashboard()),e.children["card-performance"]&&t.push(loadCardPerformanceDashboard()),e.children["product-categories"]&&t.push(displayTopCategoriesGraphOne()),t.push(loadTopVideoDashboards()),console.log("Starting Load Dashboards Requests"),Promise.all(t).then(e=>{console.log("Load Dashboards Complete",e)}).catch(e=>{const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{setLoadingStatus(!1),hideLoadingText()})}function loadDashboardsSignedOut(){const e=document.getElementsByClassName("carousel-inner")[0];let t=[];return e.children["intro-animation"]&&loadIntroAnimation(),getVideoStats().then(a=>(e.children["video-strength"]&&loadVideoStrengthDashboard(),e.children["real-time-stats"]&&t.push(loadRealTimeStatsDashboard()),e.children.thumbnails&&t.push(loadThumbnailDashboard()),e.children.platform&&t.push(loadChannelDemographics()),e.children["top-ten"]&&t.push(loadTopTenDashboard()),e.children.feedback&&t.push(loadUserFeedbackDashboard()),e.children["card-performance"]&&t.push(loadCardPerformanceDashboard()),t.push(loadGraphsFromSheets()),t.push(loadTopVideoStats()),console.log("Starting Load Dashboards Requests"),Promise.all(t).then(e=>{console.log("Load Dashboards Complete",e)}).catch(e=>{const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{setLoadingStatus(!1),hideLoadingText()})))}function initializeUpdater(){let e=new Date;e.setHours(0,0,0,0);const t=gapi.auth2.getAuthInstance().isSignedIn.get();var a=window.setInterval(()=>{const a=new Date;let n=Math.floor((a-e)/1e3);t&&(3600==n?recordUpdate("Reload Dashboards").then(e=>{window.location.reload()}):n%3600==0?updateDashboards():n%900==0&&loadDashboards());const o=document.getElementsByClassName("carousel-inner")[0];o.children["real-time-stats"]&&updateRealTimeStats(n)},1e3);return a}function initializeCarousels(){var e=document.getElementById("main-carousel-inner"),t=document.getElementById("main-indicator-list"),a=document.getElementById("dashboard-carousel");a.setAttribute("data-interval",cycleSpeed),a.setAttribute("data-pause","false");for(var n=new Array(currentSettings.numEnabled),o=0;o<currentSettings.dashboards.length;o++){var i=currentSettings.dashboards[o];i.index>=0&&n.splice(i.index,1,{name:i.name,icon:i.icon,theme:i.theme,title:i.title})}for(o=0;o<n.length;o++){var s=document.getElementById(n[o].name),r=document.getElementById("indicator").cloneNode();if(n[o].name.includes("top-video-")){s=document.getElementById("top-video-#").cloneNode(!0),dashboardText=s.outerHTML,dashboardText=dashboardText.replace(/top-video-#/g,n[o].name),dashboardText=dashboardText.replace(/TITLE PLACEHOLDER/,n[o].title);var d=document.createElement("template");d.innerHTML=dashboardText,s=d.content.firstChild}else s.remove();document.createElement("div",s.outerText),s.setAttribute("theme",n[o].theme),r.id="main-indicator-"+o,r.setAttribute("onclick","goToCarouselItem("+o+")"),r.className=n[o].icon+" indicator",e.appendChild(s),t.appendChild(r),0==o&&(s.classList.add("active"),r.classList.add("active"))}document.getElementById("top-video-#").remove()}function updateRealTimeStats(e){let t=lsGet("secondsPerIncrement"),a=lsGet("odometerCategories");for(var n in t)if(t.hasOwnProperty(n)&&e%t[n]==0){var o=a[n];o.forEach(e=>{var t=document.getElementById(e),a=parseInt(t.getAttribute("value"))+1;t.innerHTML=a,t.setAttribute("value",a)})}}function displayRealTimeStats(e){if(e=e||lsGet("realTimeStats"),e.cumulative&&e.month&&e.today){var t={};for(const a in e.today)e.today.hasOwnProperty(a)&&"averageViewDuration"!=a&&(t[a]=Math.round(43200/e.today[a]));lsSet("secondsPerIncrement",t);let o=new Date;o.setHours(6,0,0,0);const i=new Date,s=Math.round((i-o)/1e3);var a=document.getElementById("stat-avg-duration"),n={views:["stat-views-cumulative","stat-views-month"],estimatedMinutesWatched:["stat-minutes-cumulative","stat-minutes-month"],netSubscribersGained:["stat-subs-cumulative","stat-subs-month"],cumulative:{views:"stat-views-cumulative",estimatedMinutesWatched:"stat-minutes-cumulative",netSubscribersGained:"stat-subs-cumulative"},month:{views:"stat-views-month",estimatedMinutesWatched:"stat-minutes-month",netSubscribersGained:"stat-subs-month"}};lsSet("odometerCategories",n),["cumulative","month"].forEach(a=>{const o=n[a];for(const n in o)if(o.hasOwnProperty(n)){var i=o[n],r=document.getElementById(i),d=e[a][n];d+=Math.round(s/t[n]),r.setAttribute("value",d),r.innerHTML=d}});const r=secondsToDurationMinSec(e.cumulative.averageViewDuration);return a.innerHTML=r,a.value=e.cumulative.averageViewDuration,calcAvgVideoDuration(e.cumulative.averageViewDuration),Promise.resolve("Displayed Real Time Stats Dashboard")}}function calcAvgVideoDuration(){let e=lsGet("statsByVideoId");if(e){let t=0,a=0;for(let n in e)e.hasOwnProperty(n)&&(a+=parseInt(e[n].duration),t++);let n=a/t,o=document.getElementById("stat-avg-duration").value,i=decimalToPercent(o/n);isNaN(i)&&(i=36.1),document.getElementById("stat-avg-percentage").innerText=i+"%"}else document.getElementById("stat-avg-percentage").innerText="36.1%"}function getTopVideoByCategory(e,t,a){let n=lsGet("categoryStats"),o=lsGet("allVideoStats"),i=lsGet("statsByVideoId");o.sort(function(e,a){return parseInt(a[t])-parseInt(e[t])}),(null==a||a<=0)&&(a=1);let s=[],r=0,d=!1;for(;r<n.length&&!d;){if(n[r].categoryId==e){d=!0;let e=n[r].videos,t=0,l=0;for(;t<o.length&&l<a;){const a=o[t].videoId,n=i[a].organic;e.includes(a)&&n&&(s.push(a),l++),t++}}r++}return s}function displayTopVideoTitles(e){let t={};for(const a in e)if(e.hasOwnProperty(a)){const n=e[a],o=lsGet("statsByVideoId");let i=document.getElementById(n+"-title");i.innerHTML=o[a].title;const s=o[a].duration;document.getElementById(n+"-duration").innerHTML="Duration: "+secondsToDuration(s),document.getElementById(n+"-duration-seconds").innerHTML=s;let r=document.getElementById(n+"-publish-date"),d=o[a].publishDate;d=dateToMMDDYYYY(d),r.innerHTML="Published: "+d;let l=document.getElementById(n+"-thumbnail"),c="YouTube Video ID: "+a;o&&o[a]&&(c=o[a].title);let u=`\n        <a href="https://youtu.be/${a}" target="_blank"\n            alt="${c}">\n          <img class="top-video-thumbnail" onload="thumbnailCheck($(this), true)"\n              src="https://i.ytimg.com/vi/${a}/maxresdefault.jpg"\n              alt="thumbnail" title="${c}">\n        </a>`;l.innerHTML=u,t[a]={dashboardId:n,title:o[a].title,duration:o[a].duration,publishDate:d,thumbnail:u}}return t}function displayUploadThumbnails(){let e=lsGet("statsByVideoId");var t=document.getElementsByClassName("carousel-inner")[0];if(t.children.thumbnails){let t=lsGet("uploads");if(!t){const e=new Error("Uploads does not exist");throw recordError(e),e}for(var a="",n=0;n<t.length;n++){var o="YouTube Video ID: "+t[n];e&&e[t[n]]&&(o=e[t[n]].title),a+=`\n        <a href="https://youtu.be/${t[n]}" target="_blank"\n            alt="${o}">\n          <img class="thumbnail"\n              src="https://i.ytimg.com/vi/${t[n]}/mqdefault.jpg" \n              alt="thumbnail" title="${o}">\n        </a>`}var i=document.getElementById("thumbnail-container");if(i.innerHTML=a,!autoScrollDivs.includes("thumbnail-wrapper")){let e=lsGet("settings"),t=-1,a=0;for(;-1==t&&a<=e.dashboards.length;){let n=e.dashboards[a];"thumbnails"==n.name&&(t=n.scrollSpeed),a++}t=t<=0?0:Math.ceil(1e3/t),new AutoDivScroll("thumbnail-wrapper",t,1,1),autoScrollDivs.push("thumbnail-wrapper")}}return Promise.resolve("Displayed Upload Thumbnails")}function displayVideoStrengthBars(e,t){const a=lsGet("strengthCalc"),n=a.weights;let o=[],i=[];for(const t in n)if(n.hasOwnProperty(t)){const a=n[t];0!=a&&("avgViewsPerDay"==t?o.push("Average<br>Views<br>Per Day"):"likesPerView"==t?o.push("Likes<br>Per View"):"subscribersGained"==t?o.push("Subscribers<br>Gained"):"avgViewPercentage"==t?o.push("Average<br>View<br>Percentage"):"dislikesPerView"==t?o.push("Dislikes<br>Per View"):o.push(capitalizeFirstLetter(t)),a>0?i.push(e.z[t]):i.push(-1*e.z[t]))}const s=[],r="rgb(50,171,96)",d="rgb(255,0,0)";for(let e=0;e<i.length;e++){const t=i[e];t>=0?s.push(r):s.push(d)}const l=.3673,c=.2864,u=l*document.documentElement.clientHeight,h=c*document.documentElement.clientWidth,m=Math.floor(.0114*document.documentElement.clientWidth),g=Math.floor(.0067*document.documentElement.clientWidth),p=Math.floor(.0093*document.documentElement.clientWidth),b=Math.floor(.0093*document.documentElement.clientWidth),y=m+10,v=[{x:o,y:i,marker:{color:s},type:"bar"}],f={height:u,width:h,hovermode:!1,margin:{b:0,l:0,r:0,t:y},paper_bgcolor:"rgb(255,250,250)",plot_bgcolor:"rgb(255,250,250)",title:{font:{size:m},text:"Contributions to Video Strength"},xaxis:{automargin:!0,fixedrange:!0,tickangle:0,tickfont:{size:g}},yaxis:{automargin:!0,fixedrange:!0,gridcolor:"#aaaaaa",tickprefix:" ",tickfont:{size:p},title:{font:{size:b},text:"Contribution"},zerolinewidth:2}},D={scrollZoom:!1,displayModeBar:!1,staticPlot:!0,responsive:!0};try{createGraph(t,v,f,D,l,c)}catch(e){displayGraphError(t,e)}}$(".carousel").on("slide.bs.carousel",function(e){window.setTimeout(function(){updateTheme(e.to);let t=document.getElementById("top-ten-thumbnail-wrapper");t.scrollLeft!=t.scrollWidth&&(t.scrollLeft=t.scrollWidth)},250)}),window.addEventListener("resize",function(){let e=document.getElementById("top-ten");if(e.classList.contains("active")){let e=document.getElementById("top-ten-thumbnail-container");e.style.display="none",this.window.setTimeout(function(){e.style.display="flex"},500)}},!0);