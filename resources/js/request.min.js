function getAllVideoStats(e){function t(e,t){let r=getTodaysDate(),o=[];for(let e=0;e<t.length;e+=50){const s=t.slice(e,e+50),n=s.join(","),a="video=="+n,i={dimensions:"video",endDate:r,filters:a,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"averageViewDuration,subscribersGained,subscribersLost",startDate:joinDate},c=gapi.client.youtubeAnalytics.reports.query(i).then(e=>{console.log("Video Request",e);let t={};const r=e.result.rows;for(let e=0;e<r.length;e++){const o=r[e],s=o[0],n=parseInt(o[1]),a=parseInt(o[2]),i=parseInt(o[3]),c=a-i;t[s]={avgViewDuration:n,subsGained:c}}return t}).catch(t=>{const r="Error in fetching analytics stats for video group"+` ${e} - ${e+49}: `;return console.log(r,t),recordError(t,r),r});o.push(c)}return Promise.all(o).then(t=>{console.log(t);let r={};t.forEach(e=>{r=Object.assign(r,e)});for(let t=0;t<e.length;t++){const o=e[t],s=o.videoId,n=e[t].duration;let a=0,i=0;r[s]&&(a=r[s].avgViewDuration,i=r[s].subsGained);let c=a/n;c>1&&(c=1),e[t].avgViewDuration=a,e[t].avgViewPercentage=c,e[t].subscribersGained=i}return e})}let r=[];for(let t=0;t<e.length;t+=50){const o=e.slice(t,t+50),s=o.join(","),n={part:"snippet,statistics,contentDetails",id:s},a=gapi.client.youtube.videos.list(n).then(e=>{console.log("Video Request",e);let t=[];const r=e.result.items;for(let e=0;e<r.length;e++){const o=r[e],s=o.id,n=o.statistics,a=o.contentDetails.duration,i=parseInt(isoDurationToSeconds(a)),c=parseInt(n.viewCount),l=parseInt(n.likeCount),u=parseInt(n.dislikeCount),d=parseInt(n.commentCount);let h=0,g=0;0!=c&&(h=l/c,g=u/c);const p=o.snippet.publishedAt.substr(0,10),m=getNumberDaysSince(p);let y=c;0!=m&&(y=c/m),t.push({videoId:s,views:c,likes:l,dislikes:u,likesPerView:h,dislikesPerView:g,comments:d,duration:i,daysSincePublished:m,avgViewsPerDay:y,publishDate:p})}return t}).catch(e=>{const r="Error in fetching stats for video group"+` ${t} - ${t+49}: `;return console.log(r,e),recordError(e,r),r});r.push(a)}return Promise.all(r).then(r=>{console.log(r);let o=[].concat.apply([],r),s=t(o,e),n=getVideoStrengthWeights();return Promise.all([s,n])}).then(e=>{allVideoStats=e[0];const t=e[1];allVideoStats=calcVideoStrength(allVideoStats,t),lsSet("allVideoStats",allVideoStats);let r=updateCategoryTotals(allVideoStats),o=calcCategoryStats(r);const s=saveCategoryStatsToSheets(o),n=saveVideoStatsToSheets(allVideoStats),a=getTopTenVideosForCurrMonth();return Promise.all([s,n,a])})}function requestVideoViewsByYear(e,t){let r=[];const o=t+"-01-01",s=t+"-12-31";for(let t=0;t<e.length;t+=50){const n=e.slice(t,t+50),a=n.join(","),i="video=="+a,c={dimensions:"video",endDate:s,filters:i,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",startDate:o},l=gapi.client.youtubeAnalytics.reports.query(c).then(e=>e.result.rows).catch(e=>{const r="Error in fetching stats for video group"+` ${t} - ${t+49}: `;return console.error(r,e),recordError(e,r),r});r.push(l)}const n=Promise.all(r).then(e=>{const r=[].concat.apply([],e);console.log(`${t} Views by Video:`,r);const o=lsGet("statsByVideoId"),s=lsGet("categoryStats");let n={};for(let e=0;e<s.length;e++){const t=s[e].categoryId,r=s[e].shortName;n[t]={numVideos:0,shortName:r,views:0}}return r.forEach(e=>{const t=e[0],r=e[1],s=o[t].categories;for(let e=0;e<s.length;e++){const t=s[e],o=parseInt(n[t].views),a=parseInt(n[t].numVideos);n[t].views=o+r,n[t].numVideos=a+1}}),saveCategoryYearlyStatsToSheets(n,t)}).catch(e=>{const t="Unable to get video views by year: ";console.error(t,e),recordError(e,t)});return n}function requestChannelDemographics(e,t){const r={dimensions:"ageGroup,gender",endDate:t,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"viewerPercentage",sort:"gender,ageGroup",startDate:e};return gapi.client.youtubeAnalytics.reports.query(r).then(e=>(console.log("Channel Demographics",e),displayChannelDemographics(e))).catch(e=>{const t="Error getting Channel Demographics: ";console.error(t,e),recordError(e,t);const r=getDashboardGraphIds("platform"),o=r.demographics;displayGraphError(o)})}function requestChannelSearchTerms(e,t){const r={dimensions:"insightTrafficSourceDetail",endDate:t,filters:"insightTrafficSourceType==YT_SEARCH",ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",maxResults:5,metrics:"views",sort:"-views",startDate:e};return gapi.client.youtubeAnalytics.reports.query(r).then(e=>(console.log("Channel Search Terms",e),displayChannelSearchTerms(e))).catch(e=>{const t="Error getting Channel Search Terms: ";console.error(t,e),recordError(e,t);const r=getDashboardGraphIds("platform"),o=r.searchTerms;displayGraphError(o)})}function requestWatchTimeBySubscribedStatus(e,t){const r={dimensions:"subscribedStatus",endDate:t,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"estimatedMinutesWatched",startDate:e};return gapi.client.youtubeAnalytics.reports.query(r).then(e=>(console.log("Watch Time By Subscribed Status",e),displayWatchTimeBySubscribedStatus(e))).catch(e=>{const t="Error getting Watch Time By Subscribed Status: ";console.error(t,e),recordError(e,t);const r=getDashboardGraphIds("platform"),o=r.watchTime;displayGraphError(o)})}function requestViewsByDeviceType(e,t){const r={dimensions:"deviceType",endDate:t,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",sort:"-views",startDate:e};return gapi.client.youtubeAnalytics.reports.query(r).then(e=>(console.log("Views By Device Type",e),displayViewsByDeviceType(e))).catch(e=>{const t="Error getting Views By Device Type: ";console.error(t,e),recordError(e,t);const r=getDashboardGraphIds("platform"),o=r.deviceType;displayGraphError(o)})}function requestViewsByState(e,t){const r={dimensions:"province",endDate:t,filters:"country==US",ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",sort:"province",startDate:e};return gapi.client.youtubeAnalytics.reports.query(r).then(e=>(console.log("Views By State",e),displayViewsByState(e))).catch(e=>{const t="Error getting Views By State: ";console.error(t,e),recordError(e,t);const r=getDashboardGraphIds("platform"),o=r.states;displayGraphError(o)})}function requestViewsByTrafficSource(e,t){const r={dimensions:"insightTrafficSourceType",endDate:t,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",sort:"-views",startDate:e};return gapi.client.youtubeAnalytics.reports.query(r).then(e=>(console.log("Views By Traffic Source",e),displayViewsByTrafficSource(e))).catch(e=>{const t="Error getting Views By Traffic Source: ";console.error(t,e),recordError(e,t);const r=getDashboardGraphIds("platform"),o=r.trafficSource;displayGraphError(o)})}function requestRealTimeStats(e,t){const r={endDate:t,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views,subscribersGained,subscribersLost,estimatedMinutesWatched,averageViewDuration",startDate:e};return gapi.client.youtubeAnalytics.reports.query(r).then(e=>{console.log("Real Time Stats",e);let t={};const r=e.result.columnHeaders,o=e.result.rows[0];for(let e=0;e<o.length;e++)t[r[e].name]=o[e];return t.netSubscribersGained=t.subscribersGained-t.subscribersLost,delete t.subscribersGained,delete t.subscribersLost,t}).catch(e=>{const t="Error getting Real Time Stats: ";throw console.error(t,e),recordError(e,t),e})}function requestRealTimeStatsCumulative(){return requestRealTimeStats(joinDate,getDateFromDaysAgo(4))}function requestRealTimeStatsMonth(){return requestRealTimeStats(getDateFromDaysAgo(34),getDateFromDaysAgo(4))}function requestRealTimeStatsToday(){const e=getDateFromDaysAgo(3);return requestRealTimeStats(e,e)}function requestMostWatchedVideos(e,t,r,o){const s={dimensions:"video",endDate:t,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",maxResults:r,metrics:"views,estimatedMinutesWatched",sort:"-views",startDate:e};return gapi.client.youtubeAnalytics.reports.query(s).then(e=>{console.log("Most Watched Videos",e);const t=e.result.rows,r=lsGet("statsByVideoId");if(null==o)throw new Error("Month is undefined");for(var s=[[o]],n=0,a=1;a<=10;){const e=t[n][0],o=r[e].organic;o&&(s[0][a]=t[n][0],s[0][a+10]=t[n][1],s[0][a+20]=t[n][2],a++),n++}return s}).catch(e=>{const t="Error getting Most Watched Videos: ";console.error(t,e),recordError(e,t)})}function requestVideoBasicStats(e,t,r,o,s){const n="video=="+r,a={dimensions:"video",endDate:t,filters:n,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views,comments,likes,dislikes,estimatedMinutesWatched,averageViewDuration,subscribersGained,subscribersLost",startDate:e};return gapi.client.youtubeAnalytics.reports.query(a).then(e=>{console.log("Top Video Basic Stats",e);const t=displayVideoBasicStats(e,o,s);saveTopVideoStatsToSheets(t);return"Displayed Top Video Basic Stats"}).catch(e=>{const t=`Error getting basic stats for video: ${r} - `;throw console.error(t,e),recordError(e,t),new Error("Error in requestVideoBasicStats")})}function requestVideoDailyViews(e,t,r,o){const s="video=="+r,n={dimensions:"day",endDate:t,filters:s,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",sort:"day",startDate:e};return gapi.client.youtubeAnalytics.reports.query(n).then(e=>(console.log("Top Video Daily Views",e),displayVideoDailyViews(e,o),Promise.resolve(`Displayed Daily Views: ${r}`))).catch(e=>{const t=`Error getting daily views for video: ${r} - `;console.error(t,e),recordError(e,t);const s=getDashboardGraphIds(o),n=s.dailyViews;throw displayGraphError(n),new Error("Error in requestVideoDailyViews")})}function requestVideoSearchTerms(e,t,r,o){const s="video=="+r+";insightTrafficSourceType==YT_SEARCH",n={dimensions:"insightTrafficSourceDetail",endDate:t,filters:s,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",maxResults:10,metrics:"views",sort:"-views",startDate:e};return gapi.client.youtubeAnalytics.reports.query(n).then(e=>(console.log("Top Video Search Terms",e),displayVideoSearchTerms(e,o),Promise.resolve(`Displayed Search Terms: ${r}`))).catch(e=>{const t=`Error getting search terms for video: ${r} - `;console.error(t,e),recordError(e,t);const s=getDashboardGraphIds(o),n=s.searchTerms;throw displayGraphError(n),new Error("Error in requestVideoSearchTerms")})}function requestCardPerformance(e,t,r){const o={endDate:t,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"cardImpressions,cardClickRate,cardTeaserImpressions,cardTeaserClickRate",startDate:e};return gapi.client.youtubeAnalytics.reports.query(o).then(e=>{console.log(`Card Performance for month: ${r}`,e);const t=parseCardPerformance(e,r);return t}).catch(e=>{const t=`Error getting card performance for month: ${r} - `;console.error(t,e),recordError(e,t)})}function getVideographerPerformanceForMonth(e,t){const r=new Date(t),o=getYouTubeDateFormat(new Date(r.getFullYear(),r.getMonth()+2,0)),s=t.substr(0,7);let n=[],a=[];for(const r in e)if(e.hasOwnProperty(r)){a.push(r);const s=e[r],i=s.videos,c=requestVideoViews(i,t,o);n.push(c)}return Promise.all(n).then(t=>{for(let r=0;r<a.length;r++){const o=a[r],n=t[r];e[o].monthlyViews||(e[o].monthlyViews={}),e[o].monthlyViews[s]=n}return e})}function getVideographerAvgViews(e,t,r){let o=[],s=[];for(const n in e)if(e.hasOwnProperty(n)){const a=e[n];for(const e in a)if(a.hasOwnProperty(e)){const i=a[e],c=i.videos;s.push({category:e,name:n}),o.push(requestVideoViews(c,t,r))}}return Promise.all(o).then(t=>{for(let r=0;r<t.length;r++){const o=t[r],n=s[r].name,a=s[r].category,i=e[n][a].videos.length;e[n][a].lastXDaysAvgViews=o/i}return lsSet("videographers",e),e}).catch(e=>{const t="Unable to get videographer average views - ";console.error(t,e),recordError(e,t)})}function requestVideoViews(e,t,r){let o=[];for(let s=0;s<e.length;s+=50){const n=e.slice(s,s+50),a=n.join(","),i="video=="+a,c={endDate:r,filters:i,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",startDate:t},l=gapi.client.youtubeAnalytics.reports.query(c).then(e=>{const t=e.result.rows[0][0];return t}).catch(e=>{const t="Error in fetching monthly views for video group"+` ${s} - ${s+49}: `;return console.error(t,e),recordError(e,t),t});o.push(l)}return Promise.all(o).then(e=>{const t=e.reduce((e,t)=>e+t,0);return t})}function clearSpreadsheet(e,t){const r=sheetNameToId(e);if(""!=r){const e={spreadsheetId:r,range:t},o=gapi.client.sheets.spreadsheets.values.clear(e).then(e=>{const r=`Spreadsheet Cleared: ${t}`;return console.log(r),Promise.resolve(r)}).catch(e=>{const r=`Unable to get sheet: "${t}"`;console.error(r,e),recordError(e,r)});return o}{const t=`No spreadsheet exists with sheetName: "${e}"`;console.error(t);const r=new Error(t);recordError(r)}}function requestSpreadsheetData(e,t){const r=sheetNameToId(e);if(""!=r){const e={spreadsheetId:r,range:t},o=gapi.client.sheets.spreadsheets.values.get(e).then(e=>(console.log(`SpreadsheetData: ${t}`),Promise.resolve(e.result.values))).catch(e=>{const r=`Unable to get sheet: "${t}"`;console.error(r,e),recordError(e,r)});return o}{const t=`No spreadsheet exists with sheetName: "${e}"`;console.error(t);const r=new Error(t);return recordError(r),Promise.reject(t)}}function updateSheetData(e,t,r){const o=sheetNameToId(e);if(""!=o){const e={spreadsheetId:o,range:t,valueInputOption:"RAW",resource:r},s=gapi.client.sheets.spreadsheets.values.update(e).then(e=>(console.log(`UpdateSheetData: ${t}`),Promise.resolve(e))).catch(e=>{const r=`Unable to update sheet: "${t}" - `;console.error(r,e),recordError(e,r)});return s}{const t=`No spreadsheet exists with sheetName: "${e}"`;console.error(t);const r=new Error(t);recordError(r)}}function getYearlyCategoryViews(e){const t=lsGet("statsByVideoId");let r=[];for(const o in t)if(t.hasOwnProperty(o)){const s=t[o].publishDate,n=s.substr(0,4);e>=n&&r.push(o)}return requestVideoViewsByYear(r,e)}function getCardPerformanceByMonthSince(e){e=e||new Date("2017-10-1");let t=[],r=void 0;const o=new Date;for(;o-e>0;){const o=getYouTubeDateFormat(e),s=getYouTubeDateFormat(new Date(e.getFullYear(),e.getMonth()+1,0)),n=o.substr(0,7);null==r&&(r=n),t.push(requestCardPerformance(o,s,n)),e=new Date(e.getFullYear(),e.getMonth()+1,1)}return Promise.all(t).then(e=>{const t=[].concat.apply([],e),o={values:t},s=3+monthDiff(new Date(2017,9),new Date(r)),n="Card Performance!A"+s;return updateSheetData("Stats",n,o)}).catch(e=>{const t="Error occurred getting Card Performance By Month: ";console.error(t,e),recordError(e,t)})}function getTopTenVideosByMonthSince(e){e=e||new Date("2010-07-1");let t=[],r=void 0;const o=new Date;for(;o-e>0;){const o=getYouTubeDateFormat(e),s=getYouTubeDateFormat(new Date(e.getFullYear(),e.getMonth()+1,0)),n=o.substr(0,7);null==r&&(r=n),t.push(requestMostWatchedVideos(o,s,20,n)),e=new Date(e.getFullYear(),e.getMonth()+1,1)}return Promise.all(t).then(e=>{const t=[].concat.apply([],e),o={values:t},s=3+monthDiff(new Date(2010,6),new Date(r)),n="Top Ten Videos!A"+s;return updateSheetData("Stats",n,o)}).catch(e=>{const t="Error occurred getting Top Ten Videos By Month: ";console.error(t,e),recordError(e,t)})}function getVideographerPerformanceByMonthSince(e,t){t=t||new Date("2010-07-1"),console.log(t);let r=[];const o=new Date;for(;o-t>0;){const o=getYouTubeDateFormat(t);r.push(getVideographerPerformanceForMonth(e,o)),t=new Date(t.getFullYear(),t.getMonth()+1,1)}return Promise.all(r).then(t=>(console.log("videographers"),console.log(e),e)).catch(e=>{const t="Error occurred getting Card Performance By Month: ";console.error(t,e),recordError(e,t)})}function realTimeStatsCalls(){let e=[];return e.push(requestRealTimeStatsToday()),e.push(requestRealTimeStatsMonth()),e.push(requestRealTimeStatsCumulative()),Promise.all(e).then(e=>{const t={today:e[0],month:e[1],cumulative:e[2]};return lsSet("realTimeStats",t),displayRealTimeStats(t),saveRealTimeStatsToSheets(t)}).then(e=>"Real Time Stats Completed").catch(e=>{const t="Error occurred in Real Time Stats Calls: ";console.error(t,e),recordError(e,t)})}function topVideoCalls(e,t,r,o){let s=[];const n=displayTopVideoTitles(o);s.push(requestVideoBasicStats(e,t,r,o,n));for(const r in o)if(o.hasOwnProperty(r)){const n=o[r];s.push(requestVideoSearchTerms(e,t,r,n)),s.push(requestVideoDailyViews(getDateFromDaysAgo(32),t,r,n))}return Promise.all(s).then(e=>(console.log("Top Video Calls Result",e),Promise.resolve("Top Video Calls completed"))).catch(e=>{const t=`Error making Top Video Calls for video: ${r} - `;console.error(t,e),recordError(e,t)})}