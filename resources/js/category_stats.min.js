function loadSignedIn(){addDotsToLoadingText();const e=document.getElementById("home-button"),t=document.getElementById("control-panel-button"),o=document.getElementById("menu-button-container");e.style.display="inline",t.style.display="inline",o.style.display="initial",initializeUpdater(),loadDashboards(),updateTheme(0),createShortcutListeners()}function loadSignedOut(){createSignInModal("dashboards");const e=document.getElementById("authorize-button");e.onclick=handleAuthClick,$("#signinModal").modal({backdrop:"static",keyboard:!1})}function loadDashboards(){if(!isLoading&&!isUpdating){setLoadingStatus(!0);const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(showLoadingText(),resetGraphData(),e){let e=lsGet("categoryStats");e?loadDashboardsSignedIn():getBasicDashboardStats().then(e=>{loadDashboardsSignedIn()})}}}function loadDashboardsSignedIn(){let e=[];return e.push(loadProductCategoriesDashboard()),e.push(loadCategoryCharts()),console.log("Starting Load Dashboards Requests"),Promise.all(e).then(e=>{console.log("Load Dashboards Complete",e)}).catch(e=>{const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{setLoadingStatus(!1),hideLoadingText()})}function initializeUpdater(){let e=new Date;e.setHours(0,0,0,0);const t=gapi.auth2.getAuthInstance().isSignedIn.get();var o=window.setInterval(()=>{const o=new Date;let a=Math.floor((o-e)/1e3);t&&(3600==a?recordUpdate("Reload Dashboards").then(e=>{window.location.reload()}):a%900==0&&loadDashboards())},1e3);return o}function initializeCarousels(){const e=document.getElementById("category-stats-carousel");e.setAttribute("data-ride","carousel"),e.setAttribute("data-interval",cycleSpeed),e.setAttribute("data-pause","false")}function updateDashboards(){if(!isLoading&&!isUpdating){setUpdatingStatus(!0),showUpdatingText();const e=new Date;let t=[];if(0==e.getMonth()&&e.getDate()>=10&&e.getDate<=20){const o=e.getFullYear()-1;t.push(getYearlyCategoryViews(o))}return t.push(updateVideoAndCategoryStats()),Promise.all(t).then(e=>(console.log("Update Dashboards Complete",e),recordUpdate("Dashboards Updated"),hideUpdatingText(),setUpdatingStatus(!1),loadDashboards())).catch(e=>{recordUpdate("Update Failed");const t="Error occurred updating dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{hideUpdatingText(),setUpdatingStatus(!1)})}}function createShortcutListeners(){document.addEventListener("keyup",function(e){"H"==e.key.toUpperCase()&&e.altKey&&gapi.auth2.getAuthInstance().isSignedIn.get()?window.location="index.html":isMenuOpen||"N"!=e.key.toUpperCase()&&"V"!=e.key.toUpperCase()||swapNormalCharts()})}function swapNormalCharts(){var e=$(".carousel-container.active >>> .carousel-item.active")[0].id,t=e+"-chart",o=document.getElementById(t);o&&("none"==o.style.display?o.style.display="":o.style.display="none")}function displayCategoryViewsAreaCharts(e){let t=e.years,o=t.length,a=e.totals,r=[],n=[],i=[],l=[];for(var s in e)if(e.hasOwnProperty(s)&&"years"!=s&&"totals"!=s){let o=e[s].viewTrace,c=e[s].avgViewTrace,g=e[s].cumulativeViews,u=e[s].cumulativeAvgViewTrace,h=e[s].name,m=[];for(var d=0;d<o.length;d++){let e=(o[d]/a[d]*100).toFixed(2);m.push(e)}let p=categoryColors[h].color;null==p&&(p="#a0a0a0");let y=p+"80";r.push({x:t,y:o,stackgroup:"one",fillcolor:y,line:{color:p},hovertemplate:"%{text}% of %{x} views: <i>"+h+"</i><extra></extra>",name:h,text:m}),n.push({x:t,y:c,stackgroup:"one",fillcolor:y,line:{color:p},hovertemplate:"~%{y:,g} views per video in %{x}: <i>"+h+"</i><extra></extra>",name:h}),i.push({x:t,y:g,stackgroup:"one",fillcolor:y,line:{color:p},hovertemplate:"%{y:,g} views: <i>"+h+"</i><extra></extra>",name:h}),l.push({x:t,y:u,stackgroup:"one",fillcolor:y,line:{color:p},hovertemplate:"~%{y:,g} views per video: <i>"+h+"</i><extra></extra>",name:h})}var c=function(e,t){return parseInt(t.y[o-1])-parseInt(e.y[o-1])};r.sort(c),n.sort(c),i.sort(c),l.sort(c);var g=.8583,u=.9528,h=g*document.documentElement.clientHeight,m=u*document.documentElement.clientWidth,p=Math.floor(.017*document.documentElement.clientHeight),y=Math.floor(.0104*document.documentElement.clientWidth),f=Math.floor(.0156*document.documentElement.clientWidth),x=Math.floor(.0208*document.documentElement.clientWidth),v=Math.floor(.026*document.documentElement.clientWidth),b=Math.floor(.03*document.documentElement.clientWidth),w=Math.floor(.0104*document.documentElement.clientWidth);let S={height:h,width:m,hoverdistance:v,hoverlabel:{font:{size:y},namelength:-1},hovermode:"x",hovertemplate:"Test",legend:{bgcolor:"#eeeeee",font:{size:p},y:.5},margin:{b:w,t:b},paper_bgcolor:"rgba(0,0,0,0)",title:{font:{size:x},text:"Views By Category"},xaxis:{automargin:!0,fixedrange:!0,tickfont:{size:y},ticks:"outside",title:{font:{size:f},text:"Year"}},yaxis:{automargin:!0,fixedrange:!0,tickfont:{size:y},ticks:"outside",tickprefix:"  ",title:{font:{size:f},text:"Yearly Views"}}},E={scrollZoom:!1,displayModeBar:!1};const C=getDashboardGraphIds("categoryGraphs");let V=C[0],N=C[1],I=C[2],M=C[3],k=C[4],z=C[5],B=C[6],D=C[7],O=JSON.parse(JSON.stringify(r));O[0].groupnorm="percent";let T=JSON.parse(JSON.stringify(S));T.title.text="Views By Category, Normalized",T.yaxis.title.text="Percent Views",T.yaxis.ticksuffix="%";let A=JSON.parse(JSON.stringify(S));A.title.text="Cumulative Views By Category",A.yaxis.title.text="Cumulative Views";let P=JSON.parse(JSON.stringify(i));P[0].groupnorm="percent";let G=JSON.parse(JSON.stringify(A));G.title.text="Cumulative Views By Category, Normalized",G.yaxis.title.text="Percent Cumulative Views",G.yaxis.ticksuffix="%";for(d=0;d<P.length;d++){var W=P[d],J=W.name;W.hovertemplate="%{y:.2f}% of total views: <i>"+J+"</i><extra></extra>"}let U=JSON.parse(JSON.stringify(S));U.title.text="Average Views Per Video By Category",U.yaxis.title.text="Average Views Per Video",U.yaxis.tickformat=",g";let L=JSON.parse(JSON.stringify(n));L[0].groupnorm="percent";let _=JSON.parse(JSON.stringify(U));_.title.text="Average Views Per Video By Category, Normalized",_.yaxis.title.text="Percent Average Views Per Video",_.yaxis.ticksuffix="%";for(d=0;d<L.length;d++){W=L[d],J=W.name;W.hovertemplate="%{y:.2f}%: <i>"+J+"</i><extra></extra>"}let H=JSON.parse(JSON.stringify(S));H.title.text="Cumulative Average Views Per Video By Category",H.yaxis.title.text="Average Views Per Video",H.yaxis.tickformat=",g";let R=JSON.parse(JSON.stringify(l));R[0].groupnorm="percent";let $=JSON.parse(JSON.stringify(H));$.title.text="Cumulative Average Views Per Video By Category, Normalized",$.yaxis.title.text="Percent Average Views Per Video",$.yaxis.ticksuffix="%";for(d=0;d<R.length;d++){W=R[d],J=W.name;W.hovertemplate="%{y:.2f}%: <i>"+J+"</i><extra></extra>"}let F=[[V,r,S],[N,O,T],[I,i,A],[M,P,G],[k,n,U],[z,L,_],[B,l,H],[D,R,$]],Y=0;for(d=0;d<F.length;d++){let[e,t,o]=F[d];try{createGraph(e,t,o,E,g,u,!1)}catch(t){displayGraphError(e,t),Y++}}return Promise.resolve("Displayed Category Views Area Charts with "+Y+" errors")}function displayTopCategoriesGraphTwo(e){e=e||lsGet("categoryStats");const t=["SPECIAL CATEGORIES","OTHER","MISC"],o=.8583,a=.9528,r=o*document.documentElement.clientHeight,n=a*document.documentElement.clientWidth,i=Math.floor(.0156*document.documentElement.clientWidth),l=Math.floor(.01*document.documentElement.clientWidth),s=Math.floor(.01*document.documentElement.clientWidth),d=Math.floor(.013*document.documentElement.clientWidth),c=Math.floor(.01*document.documentElement.clientWidth);let g=[],u=[],h=[],m="views";for(let o=0;o<e.length;o++){const a=e[o];let r=a.root;if(r)for(let e=0;e<t.length;e++)a.name.includes(t[e])&&(r=!1);if(r){const e=Math.round(a[m]);h.push({value:e,label:a.shortName})}}h.sort(function(e,t){return e.value>t.value?-1:e.value==t.value?0:1});for(let e=0;e<h.length;e++){const t=h[e];g.push(t.value),u.push(t.label)}const p={x:u,y:g,hoverlabel:{namelength:"-1"},hovertemplate:"%{label}<br>%{value:,} views<extra></extra>",name:"Total Views<br>By Category",offsetgroup:1,type:"bar",yaxis:"y"};g=[],u=[],h=[],m="avgViews";for(let o=0;o<e.length;o++){const a=e[o];let r=a.root;if(r)for(let e=0;e<t.length;e++)a.name.includes(t[e])&&(r=!1);if(r){const e=Math.round(a[m]);h.push({value:e,label:a.shortName})}}h.sort(function(e,t){return e.value>t.value?-1:e.value==t.value?0:1});for(let e=0;e<h.length;e++){const t=h[e];g.push(t.value),u.push(t.label)}const y={x:u,y:g,hoverlabel:{namelength:"-1"},hovertemplate:"%{label}<br>~%{value:,} views per video<extra></extra>",name:"Average Views Per Video<br>By Category",offsetgroup:2,type:"bar",yaxis:"y2"},f=[p,y],x={height:r,width:n,font:{size:l},hoverlabel:{font:{size:c}},legend:{bgcolor:"#eeeeee",font:{size:s},x:.8},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",title:{font:{size:i},text:"Product Category Performance"},xaxis:{automargin:!0,fixedrange:!0,title:{font:{size:d},text:"Category"}},yaxis:{automargin:!0,fixedrange:!0,title:{font:{size:d},text:"Total Category Views"}},yaxis2:{automargin:!0,fixedrange:!0,overlaying:"y",showgrid:!1,side:"right",title:{font:{size:d},text:"Average Views Per Video"},zeroline:!1}},v={displayModeBar:!1,scrollZoom:!1},b=getDashboardGraphIds("product-categories"),w=b.graphTwo,S=getCurrentDashboardTheme("product-categories");"dark"==S&&(x.plot_bgcolor="#222",x.paper_bgcolor="#222",x.font.color="#fff",x.legend.bgcolor="#444",x.legend.font.color="#fff");try{createGraph(w,f,x,v,o,a,!1)}catch(e){displayGraphError(w,e)}}function displayTopCategoriesGraphThree(e){e=e||lsGet("categoryStats");const t=["SPECIAL CATEGORIES","OTHER","MISC"];let o=1;e.forEach(e=>{if(e.root){const t=e.strength;t<o&&(o=t)}});const a=.8583,r=.9528,n=a*document.documentElement.clientHeight,i=r*document.documentElement.clientWidth,l=Math.floor(.0125*document.documentElement.clientWidth),s=Math.floor(.01*document.documentElement.clientWidth),d=Math.floor(.01*document.documentElement.clientWidth),c=Math.floor(.013*document.documentElement.clientWidth),g=Math.floor(.01*document.documentElement.clientWidth);let u=[],h=[],m=[],p=[],y=[],f=[],x=[];const v=categoryColors;for(let o=0;o<e.length;o++){let a=e[o],r=a.root;if(r)for(let e=0;e<t.length;e++)a.name.includes(t[e])&&(r=!1);if(r){let e=Math.round(a.views),t=Math.round(a.avgViews),r=Math.round(100*a.avgStrength),n=a.videos.length,i=a.shortName,l=v[a.shortName].color;0!=r&&(u.push(e),h.push(t),m.push(n),p.push(i),y.push(l),f.push(o),x.push({x:[e],y:[n],mode:"markers",type:"scatter",marker:{color:[l],size:[r],sizemode:"area"},customdata:[[Math.round(a.avgStrength),o]],name:i,text:[i],hoverlabel:{namelength:"-1"},hovertemplate:"<b>%{text}</b><br>%{x:,} views<br>%{y} videos<br>Category Strength: %{customdata[0]:,}<extra></extra>"}))}}let b={height:n,width:i,font:{size:s},hoverlabel:{font:{size:g}},hovermode:"closest",legend:{bgcolor:"#eeeeee",font:{size:d},y:.5},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",title:{font:{size:l},text:"<b>Product Category Performance</b><br>Circle Area is proportional to Category Strength"},xaxis:{automargin:!0,fixedrange:!0,gridcolor:"#aaaaaa",title:{font:{size:c},text:"Total Category Views"},type:"log"},yaxis:{automargin:!0,fixedrange:!0,gridcolor:"#888888",title:{font:{size:c},text:"Number of Videos"},type:"log"}};const w={displayModeBar:!1,scrollZoom:!1},S=getDashboardGraphIds("product-categories"),E=S.graphThree,C=getCurrentDashboardTheme("product-categories");"dark"==C&&(b.plot_bgcolor="#222",b.paper_bgcolor="#222",b.font.color="#fff",b.legend.bgcolor="#444",b.legend.font.color="#fff");try{createGraph(E,x,b,w,a,r,!1);const t=document.getElementById(E);t.on("plotly_click",t=>{const o=t.points[0].text,a=t.points[0]["marker.color"],r=t.points[0].customdata[1],n=e[r];displayCategoryStrengthBars(n,o,a)})}catch(e){displayGraphError(E,e)}}function hideCategoryStrengthGraph(){document.getElementById("category-graph-container").style.display="none"}function showCategoryStrengthGraph(){document.getElementById("category-graph-container").style.display="",document.getElementById("popup-graph-loading").style.display="",document.getElementById("category-strength-popup-graph").style.display="none"}function displayCategoryStrengthBars(e,t,o){const a=lsGet("allVideoStats"),r=document.getElementById("popup-graph-title");r.innerHTML=t,showCategoryStrengthGraph();let n=[],i=0,l=5,s=100;for(let e=0;e<s;e+=l)n.push({binNum:i,minNum:e,maxNum:e+l,count:0}),i++;const d=e.videosWithStrength;d.forEach(e=>{const t=a.findIndex(t=>e==t.videoId),o=a[t].strength;for(let e=0;e<n.length;e++){let t=n[e];o>t.minNum&&o<=t.maxNum&&t.count++}});let c=[],g=[],u=[],h=[];for(let e=0;e<n.length;e++){const t=n[e];c.push(t.minNum),g.push(t.count/d.length);let o=`${t.count} videos`;1==t.count&&(o=`${t.count} video`),u.push([o,`${t.minNum} - ${t.maxNum}`]),e%2==0?h.push(String(t.minNum)):h.push("")}const m=[{x:c,y:g,customdata:u,hovermode:"none",hovertemplate:"%{customdata[1]}<br>%{customdata[0]}<extra></extra>",offset:.5,marker:{color:o},type:"bar"}];var p=.2938,y=.2713,f=p*document.documentElement.clientHeight,x=y*document.documentElement.clientWidth,v=Math.floor(.02*document.documentElement.clientWidth),b=Math.floor(.02*document.documentElement.clientWidth);const w={height:f,width:x,bargap:0,hovermode:"closest",margin:{b:0,l:0,r:b,t:v},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",title:{text:"Distribution of Video Strength"},xaxis:{automargin:!0,fixedrange:!0,tickmode:"array",ticktext:h,tickvals:c,title:{text:"Video Strength"}},yaxis:{automargin:!0,fixedrange:!0,gridcolor:"#888888",tickprefix:"   ",title:{text:"Relative Frequency"},zerolinewidth:2}},S={scrollZoom:!1,displayModeBar:!1,responsive:!0},E="category-strength-popup-graph";try{createGraph(E,m,w,S,p,y,!1),document.getElementById(E).style.display="initial",document.getElementById("popup-graph-loading").style.display="none"}catch(e){displayGraphError(E,e)}}