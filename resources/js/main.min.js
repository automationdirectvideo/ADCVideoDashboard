function loadDashboards(){if(!isLoading&&!isUpdating){isLoading=!0;const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(showLoadingText(),resetGraphData(),e){let e=JSON.parse(localStorage.getItem("categoryStats"));e?loadDashboardsSignedIn():getCategoryAndVideoStats().then(e=>{loadDashboardsSignedIn()})}else loadDashboardsSignedOut()}}function loadDashboardsSignedIn(){const e=document.getElementsByClassName("carousel-inner")[0];let t=[];return e.children["intro-animation"]&&loadIntroAnimation(),e.children["video-strength"]&&loadVideoStrengthDashboard(),e.children["real-time-stats"]&&t.push(loadRealTimeStatsDashboard()),e.children.thumbnails&&t.push(loadThumbnailDashboard()),e.children.platform&&t.push(loadPlatformDashboard()),e.children["top-ten"]&&t.push(loadTopTenDashboard()),e.children.feedback&&t.push(loadUserFeedbackDashboard()),e.children["card-performance"]&&t.push(loadCardPerformanceDashboard()),e.children["product-categories"]&&(t.push(loadProductCategoriesDashboard()),t.push(loadCategoryCharts())),t.push(loadTopVideoDashboards()),console.log("Starting Load Dashboards Requests"),Promise.all(t).then(e=>{console.log("Load Dashboards Complete",e)}).catch(e=>{const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{isLoading=!1,hideLoadingText()})}function loadDashboardsSignedOut(){const e=document.getElementsByClassName("carousel-inner")[0];let t=[];return e.children["intro-animation"]&&loadIntroAnimation(),getVideoStats().then(a=>(e.children["video-strength"]&&loadVideoStrengthDashboard(),e.children["real-time-stats"]&&t.push(loadRealTimeStatsDashboard()),e.children.thumbnails&&t.push(loadThumbnailDashboard()),e.children.platform&&t.push(loadChannelDemographics()),e.children["top-ten"]&&t.push(loadTopTenDashboard()),e.children.feedback&&t.push(loadUserFeedbackDashboard()),e.children["card-performance"]&&t.push(loadCardPerformanceDashboard()),t.push(loadGraphsFromSheets()),t.push(loadTopVideoStats()),console.log("Starting Load Dashboards Requests"),Promise.all(t).then(e=>{console.log("Load Dashboards Complete",e)}).catch(e=>{const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{isLoading=!1,hideLoadingText()})))}function initializeUpdater(){let e=new Date;e.setHours(0,0,0,0);const t=gapi.auth2.getAuthInstance().isSignedIn.get();var a=window.setInterval(()=>{const a=new Date;let o=Math.floor((a-e)/1e3);t&&(3600==o?recordUpdate("Reload Dashboards").then(e=>{window.location.reload()}):o%3600==0?updateDashboards():o%900==0&&loadDashboards());const r=document.getElementsByClassName("carousel-inner")[0];r.children["real-time-stats"]&&updateRealTimeStats(o)},1e3);return a}function updateRealTimeStats(e){let t=JSON.parse(localStorage.getItem("secondsPerIncrement")),a=JSON.parse(localStorage.getItem("odometerCategories"));for(var o in t)if(t.hasOwnProperty(o)&&e%t[o]==0){var r=a[o];r.forEach(e=>{var t=document.getElementById(e),a=parseInt(t.getAttribute("value"))+1;t.innerHTML=a,t.setAttribute("value",a)})}}function displayRealTimeStats(e){if(e=e||JSON.parse(localStorage.getItem("realTimeStats")),e.cumulative&&e.month&&e.today){var t={};for(const a in e.today)e.today.hasOwnProperty(a)&&"averageViewDuration"!=a&&(t[a]=Math.round(43200/e.today[a]));localStorage.setItem("secondsPerIncrement",JSON.stringify(t));let r=new Date;r.setHours(6,0,0,0);const n=new Date,i=Math.round((n-r)/1e3);var a=document.getElementById("stat-avg-duration"),o={views:["stat-views-cumulative","stat-views-month"],estimatedMinutesWatched:["stat-minutes-cumulative","stat-minutes-month"],netSubscribersGained:["stat-subs-cumulative","stat-subs-month"],cumulative:{views:"stat-views-cumulative",estimatedMinutesWatched:"stat-minutes-cumulative",netSubscribersGained:"stat-subs-cumulative"},month:{views:"stat-views-month",estimatedMinutesWatched:"stat-minutes-month",netSubscribersGained:"stat-subs-month"}};localStorage.setItem("odometerCategories",JSON.stringify(o)),["cumulative","month"].forEach(a=>{const r=o[a];for(const o in r)if(r.hasOwnProperty(o)){var n=r[o],l=document.getElementById(n),s=e[a][o];s+=Math.round(i/t[o]),l.setAttribute("value",s),l.innerHTML=s}});const l=secondsToDurationMinSec(e.cumulative.averageViewDuration);return a.innerHTML=l,a.value=e.cumulative.averageViewDuration,calcAvgVideoDuration(e.cumulative.averageViewDuration),Promise.resolve("Displayed Real Time Stats Dashboard")}}function loadIntroAnimation(){let e=document.getElementById("intro-img"),t=document.getElementById("intro-video");if(4!=t.readyState&&t.load(),t.paused){var a=t.play();void 0!==a&&a.then(a=>{e.style.display="none",t.style.display="initial"}).catch(a=>{document.getElementsByTagName("VIDEO")[0].play(),e.style.display="none",t.style.display="initial"})}}function calcAvgVideoDuration(){let e=JSON.parse(localStorage.getItem("statsByVideoId"));if(e){let t=0,a=0;for(let o in e)e.hasOwnProperty(o)&&(a+=parseInt(e[o].duration),t++);let o=a/t,r=document.getElementById("stat-avg-duration").value,n=decimalToPercent(r/o);isNaN(n)&&(n=36.1),document.getElementById("stat-avg-percentage").innerText=n+"%"}else document.getElementById("stat-avg-percentage").innerText="36.1%"}function getTopVideoByCategory(e,t,a){let o=JSON.parse(localStorage.getItem("categoryStats")),r=JSON.parse(localStorage.getItem("allVideoStats"));r.sort(function(e,a){return parseInt(a[t])-parseInt(e[t])}),(null==a||a<=0)&&(a=1);let n=[],i=0,l=!1;for(;i<o.length&&!l;){if(o[i].categoryId==e){l=!0;let e=o[i].videos,t=0,s=0;for(;t<r.length&&s<a;)e.includes(r[t].videoId)&&(n.push(r[t].videoId),s++),t++}i++}return n}function displayCategoryViewsAreaCharts(e){let t=e.years,a=t.length,o=e.totals,r=[],n=[],i=[],l=[];for(var s in e)if(e.hasOwnProperty(s)&&"years"!=s&&"totals"!=s){let a=e[s].viewTrace,c=e[s].avgViewTrace,u=e[s].cumulativeViews,g=e[s].cumulativeAvgViewTrace,h=e[s].name,m=[];for(var d=0;d<a.length;d++){let e=(a[d]/o[d]*100).toFixed(2);m.push(e)}let p=categoryColors[h].color;null==p&&(p="#a0a0a0");let y=p+"80";r.push({x:t,y:a,stackgroup:"one",fillcolor:y,line:{color:p},hovertemplate:"%{text}% of %{x} views: <i>"+h+"</i><extra></extra>",name:h,text:m}),n.push({x:t,y:c,stackgroup:"one",fillcolor:y,line:{color:p},hovertemplate:"~%{y:,g} views per video in %{x}: <i>"+h+"</i><extra></extra>",name:h}),i.push({x:t,y:u,stackgroup:"one",fillcolor:y,line:{color:p},hovertemplate:"%{y:,g} views: <i>"+h+"</i><extra></extra>",name:h}),l.push({x:t,y:g,stackgroup:"one",fillcolor:y,line:{color:p},hovertemplate:"~%{y:,g} views per video: <i>"+h+"</i><extra></extra>",name:h})}var c=function(e,t){return parseInt(t.y[a-1])-parseInt(e.y[a-1])};r.sort(c),n.sort(c),i.sort(c),l.sort(c);var u=.8583,g=.9528,h=u*document.documentElement.clientHeight,m=g*document.documentElement.clientWidth,p=Math.floor(.017*document.documentElement.clientHeight),y=Math.floor(.0104*document.documentElement.clientWidth),f=Math.floor(.0156*document.documentElement.clientWidth),v=Math.floor(.0208*document.documentElement.clientWidth),b=Math.floor(.026*document.documentElement.clientWidth),S=Math.floor(.03*document.documentElement.clientWidth),I=Math.floor(.0104*document.documentElement.clientWidth);let w={height:h,width:m,hoverdistance:b,hoverlabel:{font:{size:y},namelength:-1},hovermode:"x",hovertemplate:"Test",legend:{bgcolor:"#eeeeee",font:{size:p},y:.5},margin:{b:I,t:S},paper_bgcolor:"rgba(0,0,0,0)",title:{font:{size:v},text:"Views By Category"},xaxis:{automargin:!0,fixedrange:!0,tickfont:{size:y},ticks:"outside",title:{font:{size:f},text:"Year"}},yaxis:{automargin:!0,fixedrange:!0,tickfont:{size:y},ticks:"outside",tickprefix:"  ",title:{font:{size:f},text:"Yearly Views"}}},x={scrollZoom:!1,displayModeBar:!1},E="categories-views-chart",C="categories-normal-views-chart",T="categories-cum-views-chart",N="categories-normal-cum-views-chart",O="categories-avg-views-chart",D="categories-normal-avg-views-chart",V="categories-cum-avg-views-chart",B="categories-normal-cum-avg-views-chart",k=JSON.parse(JSON.stringify(r));k[0].groupnorm="percent";let P=JSON.parse(JSON.stringify(w));P.title.text="Views By Category, Normalized",P.yaxis.title.text="Percent Views",P.yaxis.ticksuffix="%";let J=JSON.parse(JSON.stringify(w));J.title.text="Cumulative Views By Category",J.yaxis.title.text="Cumulative Views";let M=JSON.parse(JSON.stringify(i));M[0].groupnorm="percent";let A=JSON.parse(JSON.stringify(J));A.title.text="Cumulative Views By Category, Normalized",A.yaxis.title.text="Percent Cumulative Views",A.yaxis.ticksuffix="%";for(d=0;d<M.length;d++){var L=M[d],z=L.name;L.hovertemplate="%{y:.2f}% of total views: <i>"+z+"</i><extra></extra>"}let G=JSON.parse(JSON.stringify(w));G.title.text="Average Views Per Video By Category",G.yaxis.title.text="Average Views Per Video",G.yaxis.tickformat=",g";let $=JSON.parse(JSON.stringify(n));$[0].groupnorm="percent";let H=JSON.parse(JSON.stringify(G));H.title.text="Average Views Per Video By Category, Normalized",H.yaxis.title.text="Percent Average Views Per Video",H.yaxis.ticksuffix="%";for(d=0;d<$.length;d++){L=$[d],z=L.name;L.hovertemplate="%{y:.2f}%: <i>"+z+"</i><extra></extra>"}let W=JSON.parse(JSON.stringify(w));W.title.text="Cumulative Average Views Per Video By Category",W.yaxis.title.text="Average Views Per Video",W.yaxis.tickformat=",g";let U=JSON.parse(JSON.stringify(l));U[0].groupnorm="percent";let R=JSON.parse(JSON.stringify(W));R.title.text="Cumulative Average Views Per Video By Category, Normalized",R.yaxis.title.text="Percent Average Views Per Video",R.yaxis.ticksuffix="%";for(d=0;d<U.length;d++){L=U[d],z=L.name;L.hovertemplate="%{y:.2f}%: <i>"+z+"</i><extra></extra>"}let _=[[E,r,w],[C,k,P],[T,i,J],[N,M,A],[O,n,G],[D,$,H],[V,l,W],[B,U,R]];categoryGraphData={};let F=0;for(d=0;d<_.length;d++){let[e,t,a]=_[d];try{Plotly.newPlot(e,t,a,x),recordGraphData(e,t,a,x,u,g),recordGraphSize(e,u,g),categoryGraphData[e]={data:t,layout:a,config:x,graphHeight:u,graphWidth:g,automargin:"None"}}catch(t){const a=`There was an error initiating graph: ${e} - `;displayGraphError(e),console.error(a,t),recordError(t,a),F++}}return Promise.resolve("Displayed Category Views Area Charts with "+F+" errors")}function displayTopCategoriesGraphOne(e){e=e||JSON.parse(localStorage.getItem("categoryStats"));var t=["SPECIAL CATEGORIES","OTHER","MISC"],a=0;let o=0;for(var r=.8583,n=.9528,i=r*document.documentElement.clientHeight,l=n*document.documentElement.clientWidth,s=Math.floor(.0234*document.documentElement.clientWidth),d=Math.floor(.02*document.documentElement.clientWidth),c=Math.floor(.0125*document.documentElement.clientWidth),u=[],g=[],h=[],m="views",p=.025,y=categoryColors,f=0;f<e.length;f++){let o=e[f],r=o.root;if(r)for(var v=0;v<t.length;v++)o.name.includes(t[v])&&(r=!1);r&&(a+=Math.round(o[m]))}for(f=0;f<e.length;f++){let r=e[f],n=r.root;if(n)for(v=0;v<t.length;v++)r.name.includes(t[v])&&(n=!1);if(n){let e=Math.round(r[m]);e/a<=p?o+=e:(u.push(e),g.push(y[r.shortName].name),h.push(y[r.shortName].color))}}null!=p&&p>0&&(u.push(o),g.push("Other"),h.push("#5fe0ed"));var b={values:u,labels:g,marker:{colors:h},domain:{row:0,column:0},name:"Total Views<br>By Category",title:{text:"Total Views<br>By Category",font:{size:s}},textinfo:"label",textposition:"inside",hoverlabel:{namelength:"-1"},hovertemplate:"%{label}<br>%{value} views<br>%{percent}",sort:!1,type:"pie",rotation:90};a=0,o=0,u=[],g=[],h=[],m="avgViews",p=.025;for(f=0;f<e.length;f++){let o=e[f],r=o.root;if(r)for(v=0;v<t.length;v++)o.name.includes(t[v])&&(r=!1);r&&(a+=Math.round(o[m]))}for(f=0;f<e.length;f++){let r=e[f],n=r.root;if(n)for(v=0;v<t.length;v++)r.name.includes(t[v])&&(n=!1);if(n){let e=Math.round(r[m]);e/a<=p?o+=e:(u.push(e),g.push(y[r.shortName].name),h.push(y[r.shortName].color))}}null!=p&&p>0&&(u.push(o),g.push("Other"),h.push("#5fe0ed"));for(var S={values:u,labels:g,marker:{colors:h},domain:{row:0,column:1},name:"Average Views Per Video<br>By Category",title:{text:"Average Views Per Video<br>By Category",font:{size:s}},textinfo:"label",textposition:"inside",hoverlabel:{namelength:"-1"},hovertemplate:"%{label}<br>~%{value} views per video<br>%{percent}",sort:!1,type:"pie",rotation:140},I=[S,b],w={height:i,width:l,font:{size:d},automargin:!0,autosize:!0,paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",legend:{bgcolor:"#eeeeee",font:{size:c},y:.5},grid:{rows:1,columns:2},margin:{b:5,l:5,r:5,t:5}},x={staticPlot:!0,responsive:!0},E="product-categories-chart-1",C=JSON.parse(localStorage.getItem("settings")),T="",N=0;N<C.dashboards.length&&""==T;)"product-categories"==C.dashboards[N].name&&(T=C.dashboards[N].theme),N++;"dark"==T&&(w.plot_bgcolor="#222",w.paper_bgcolor="#222",w.font.color="#fff",w.legend.bgcolor="#444",w.legend.font.color="#fff");try{Plotly.newPlot(E,I,w,x),recordGraphData(E,I,w,x,r,n),recordGraphSize(E,r,n)}catch(e){displayGraphError(E,e)}}function displayTopCategoriesGraphTwo(e){e=e||JSON.parse(localStorage.getItem("categoryStats"));for(var t=["SPECIAL CATEGORIES","OTHER","MISC"],a=.8583,o=.9528,r=a*document.documentElement.clientHeight,n=o*document.documentElement.clientWidth,i=Math.floor(.0156*document.documentElement.clientWidth),l=Math.floor(.01*document.documentElement.clientWidth),s=Math.floor(.01*document.documentElement.clientWidth),d=Math.floor(.013*document.documentElement.clientWidth),c=[],u=[],g=[],h="views",m=0;m<e.length;m++){let a=e[m],o=a.root;if(o)for(var p=0;p<t.length;p++)a.name.includes(t[p])&&(o=!1);if(o){let e=Math.round(a[h]);g.push({value:e,label:a.shortName})}}g.sort(function(e,t){return e.value>t.value?-1:e.value==t.value?0:1});for(let e=0;e<g.length;e++){const t=g[e];c.push(t.value),u.push(t.label)}var y={x:u,y:c,name:"Total Views<br>By Category",type:"bar",yaxis:"y",offsetgroup:1,hoverlabel:{namelength:"-1"},hovertemplate:"%{label}<br>%{value:,} views"};c=[],u=[],g=[],h="avgViews";for(m=0;m<e.length;m++){let a=e[m],o=a.root;if(o)for(p=0;p<t.length;p++)a.name.includes(t[p])&&(o=!1);if(o){let e=Math.round(a[h]);g.push({value:e,label:a.shortName})}}g.sort(function(e,t){return e.value>t.value?-1:e.value==t.value?0:1});for(let e=0;e<g.length;e++){const t=g[e];c.push(t.value),u.push(t.label)}var f={x:u,y:c,name:"Average Views Per Video<br>By Category",type:"bar",yaxis:"y2",offsetgroup:2,hoverlabel:{namelength:"-1"},hovertemplate:"%{label}<br>~%{value:,} views per video"},v=[y,f],b={height:r,width:n,font:{size:l},paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",legend:{bgcolor:"#eeeeee",font:{size:s},x:.8},title:{font:{size:i},text:"Product Category Performance"},xaxis:{automargin:!0,fixedrange:!0,title:{font:{size:d},text:"Category"}},yaxis:{automargin:!0,fixedrange:!0,title:{font:{size:d},text:"Total Category Views"}},yaxis2:{automargin:!0,fixedrange:!0,showgrid:!1,overlaying:"y",side:"right",zeroline:!1,title:{font:{size:d},text:"Average Views Per Video"}}};let S={scrollZoom:!1,displayModeBar:!1};for(var I="product-categories-chart-2",w=JSON.parse(localStorage.getItem("settings")),x="",E=0;E<w.dashboards.length&&""==x;)"product-categories"==w.dashboards[E].name&&(x=w.dashboards[E].theme),E++;"dark"==x&&(b.plot_bgcolor="#222",b.paper_bgcolor="#222",b.font.color="#fff",b.legend.bgcolor="#444",b.legend.font.color="#fff");try{Plotly.newPlot(I,v,b,S),recordGraphData(I,v,b,S,a,o),recordGraphSize(I,a,o)}catch(e){displayGraphError(I,e)}}function displayTopCategoriesGraphThree(e){e=e||JSON.parse(localStorage.getItem("categoryStats"));var t=["SPECIAL CATEGORIES","OTHER","MISC"];let a=1;e.forEach(e=>{if(e.root){let t=e.strength;t<a&&(a=t)}});var o=.8583,r=.9528,n=o*document.documentElement.clientHeight,i=r*document.documentElement.clientWidth,l=Math.floor(.0125*document.documentElement.clientWidth),s=Math.floor(.01*document.documentElement.clientWidth),d=Math.floor(.01*document.documentElement.clientWidth),c=Math.floor(.013*document.documentElement.clientWidth);let u=[],g=[],h=[],m=[],p=[],y=[],f=categoryColors;for(var v=0;v<e.length;v++){let a=e[v],o=a.root;if(o)for(var b=0;b<t.length;b++)a.name.includes(t[b])&&(o=!1);if(o){let e=Math.round(a.views),t=Math.round(a.avgViews),o=Math.round(100*a.avgStrength),r=a.videos.length,n=a.shortName,i=f[a.shortName].color;u.push(e),g.push(t),h.push(r),m.push(n),p.push(i),y.push({x:[e],y:[r],mode:"markers",type:"scatter",marker:{color:[i],size:[o],sizemode:"area"},customdata:[Math.round(a.avgStrength)],name:n,text:[n],hoverlabel:{namelength:"-1"},hovertemplate:"<b>%{text}</b><br>%{x:,} views<br>%{y} videos<br>Category Strength: %{customdata:,}<extra></extra>"})}}var S={height:n,width:i,font:{size:s},hovermode:"closest",paper_bgcolor:"rgba(0,0,0,0)",plot_bgcolor:"rgba(0,0,0,0)",legend:{bgcolor:"#eeeeee",font:{size:d},y:.5},title:{font:{size:l},text:"<b>Product Category Performance</b><br>Circle Area is proportional to Category Strength"},xaxis:{automargin:!0,fixedrange:!0,gridcolor:"#aaaaaa",title:{font:{size:c},text:"Total Category Views"},type:"log"},yaxis:{automargin:!0,fixedrange:!0,gridcolor:"#888888",title:{font:{size:c},text:"Number of Videos"},type:"log"}};let I={scrollZoom:!1,displayModeBar:!1};for(var w="product-categories-chart-3",x=JSON.parse(localStorage.getItem("settings")),E="",C=0;C<x.dashboards.length&&""==E;)"product-categories"==x.dashboards[C].name&&(E=x.dashboards[C].theme),C++;"dark"==E&&(S.plot_bgcolor="#222",S.paper_bgcolor="#222",S.font.color="#fff",S.legend.bgcolor="#444",S.legend.font.color="#fff");try{Plotly.newPlot(w,y,S,I),recordGraphData(w,y,S,I,o,r),recordGraphSize(w,o,r)}catch(e){displayGraphError(w,e)}}function calcVideographerStats(){let e=JSON.parse(localStorage.getItem("allVideoStats")),t=JSON.parse(localStorage.getItem("statsByVideoId")),a={};return e.forEach(e=>{const o=e.videoId,r=e.comments,n=e.dislikes,i=e.duration,l=e.likes,s=e.views;let d=t[o],c=d.createdBy;a[c]||(a[c]={comments:0,dislikes:0,likes:0,numVideos:0,totalDuration:0,views:0}),a[c].comments+=r,a[c].dislikes+=n,a[c].likes+=l,a[c].numVideos+=1,a[c].totalDuration+=i,a[c].views+=s}),a}function displayTopVideoTitles(e){let t={};for(const a in e)if(e.hasOwnProperty(a)){const o=e[a],r=JSON.parse(localStorage.getItem("statsByVideoId"));let n=document.getElementById(o+"-title");n.innerHTML=r[a].title;const i=r[a].duration;document.getElementById(o+"-duration").innerHTML="Duration: "+secondsToDuration(i),document.getElementById(o+"-duration-seconds").innerHTML=i;let l=document.getElementById(o+"-publish-date"),s=r[a].publishDate;const d=s.slice(0,4),c=s.slice(5,7),u=s.slice(8,10);s=c+"/"+u+"/"+d,l.innerHTML="Published: "+s;let g=document.getElementById(o+"-thumbnail"),h="YouTube Video ID: "+a;r&&r[a]&&(h=r[a].title);let m=`\n        <a href="https://youtu.be/${a}" target="_blank"\n            alt="${h}">\n          <img class="top-video-thumbnail" onload="thumbnailCheck($(this), true)"\n              src="https://i.ytimg.com/vi/${a}/maxresdefault.jpg"\n              alt="thumbnail" title="${h}">\n        </a>`;g.innerHTML=m,t[a]={dashboardId:o,title:r[a].title,duration:r[a].duration,publishDate:s,thumbnail:m}}return t}function displayUploadThumbnails(){let e=JSON.parse(localStorage.getItem("statsByVideoId"));var t=document.getElementsByClassName("carousel-inner")[0];if(t.children.thumbnails){let t=JSON.parse(localStorage.getItem("uploads"));if(!t){const e=new Error("Uploads does not exist");throw recordError(e),e}for(var a="",o=0;o<t.length;o++){var r="YouTube Video ID: "+t[o];e&&e[t[o]]&&(r=e[t[o]].title),a+=`\n        <a href="https://youtu.be/${t[o]}" target="_blank"\n            alt="${r}">\n          <img class="thumbnail"\n              src="https://i.ytimg.com/vi/${t[o]}/mqdefault.jpg" \n              alt="thumbnail" title="${r}">\n        </a>`}var n=document.getElementById("thumbnail-container");if(n.innerHTML=a,!autoScrollDivs.includes("thumbnail-wrapper")){let e=JSON.parse(localStorage.getItem("settings")),t=-1,a=0;for(;-1==t&&a<=e.dashboards.length;){let o=e.dashboards[a];"thumbnails"==o.name&&(t=o.scrollSpeed),a++}t=t<=0?0:Math.ceil(1e3/t),new AutoDivScroll("thumbnail-wrapper",t,1,1),autoScrollDivs.push("thumbnail-wrapper")}}return Promise.resolve("Displayed Upload Thumbnails")}function loadVideoStrengthDashboard(){let e=JSON.parse(localStorage.getItem("statsByVideoId")),t=JSON.parse(localStorage.getItem("allVideoStats"));t.sort(function(e,t){return e.strength==t.strength?t.daysSincePublished-e.daysSincePublished:t.strength-e.strength});let a=20,o="";for(var r=0;r<a;r++){var n=t[r].videoId,i=Math.round(100*t[r].strength)/100;let s="YouTube Video ID: "+n;e&&e[n]&&(s=e[n].title),o+=`\n      <div class="col-1">\n        <h1>${r+1}.</h1>\n      </div>\n      <div class="col-4">\n        <a href="https://youtu.be/${n}" target="_blank"\n            alt="${s}">\n          <img class="feedback-thumbnail" onload="thumbnailCheck($(this), true)"\n              src="https://i.ytimg.com/vi/${n}/maxresdefault.jpg"\n              alt="thumbnail" title="${s}">\n        </a>\n      </div>\n      <div class="col-7">\n        <h1 class="video-strength-title">${s}</h1>\n        <h2 class="video-strength-value">Strength: ${i}</h2>\n      </div>\n    `;var l='\n      <div class="col-12">\n        <hr style="border-top:0.25rem solid rgba(0,0,0,.3);">\n      </div>\n    ';r!=a-1&&(o+=l)}let s=document.getElementById("video-strength-container");if(s.innerHTML=o,!autoScrollDivs.includes("video-strength-wrapper")){let e=JSON.parse(localStorage.getItem("settings")),t=-1,a=0;for(;-1==t&&a<=e.dashboards.length;){let o=e.dashboards[a];"video-strength"==o.name&&(t=o.scrollSpeed),a++}t=t<=0?0:Math.ceil(1e3/t),new AutoDivScroll("video-strength-wrapper",t,1,1),autoScrollDivs.push("video-strength-wrapper")}}function updateCategoryTotals(e){let t=JSON.parse(localStorage.getItem("statsByVideoId")),a=JSON.parse(localStorage.getItem("categoryTotals"));return e.forEach(e=>{let o=e.videoId,r=e.duration,n=e.views,i=e.likes,l=e.strength;t[o].duration=r;let s=t[o].categories;for(let e=0;e<s.length;e++){let t=s[e];null==a[t]&&(a[t]={},a[t].videos=[]);let d=parseInt(a[t].views),c=parseInt(a[t].likes),u=parseInt(a[t].duration),g=parseFloat(a[t].strength),h=a[t].videos;h.push(o),a[t].views=d+n,a[t].likes=c+i,a[t].duration=u+r,a[t].strength=g+l,a[t].videos=h}}),localStorage.setItem("categoryTotals",JSON.stringify(a)),localStorage.setItem("statsByVideoId",JSON.stringify(t)),a}function calcCategoryStats(e){let t=[];for(let a in e)if(e.hasOwnProperty(a)){let o=e[a],r=o.shortName,n=o.name,i=o.root,l=o.leaf,s=parseInt(o.views),d=parseInt(o.likes),c=parseInt(o.duration),u=parseFloat(o.strength),g=o.videos,h=g.length,m=s/h,p=d/h,y=c/h,f=u/h;t.push({avgDuration:y,avgLikes:p,avgViews:m,categoryId:a,duration:c,leaf:l,likes:d,name:n,root:i,shortName:r,totalStrength:u,avgStrength:f,videos:g,views:s})}return localStorage.setItem("categoryStats",JSON.stringify(t)),t}function recordGraphData(e,t,a,o,r,n,i){totalNumGraphs=document.querySelectorAll(".graph-container").length;let l=JSON.parse(localStorage.getItem("graphData"));i||(i="None"),l[e]={data:t,layout:a,config:o,graphHeight:r,graphWidth:n,automargin:i},Object.keys(l).length==totalNumGraphs?(localStorage.setItem("graphData",JSON.stringify(l)),gapi.auth2.getAuthInstance().isSignedIn.get()&&saveGraphDataToSheets()):localStorage.setItem("graphData",JSON.stringify(l))}function recordGraphSize(e,t,a,o){localStorage.getItem("graphSizes")||localStorage.setItem("graphSizes",JSON.stringify({}));let r=JSON.parse(localStorage.getItem("graphSizes"));r[e]={height:t,width:a},o&&(r[e].automargin=o),localStorage.setItem("graphSizes",JSON.stringify(r))}function resetGraphData(){localStorage.setItem("graphData","{}"),localStorage.setItem("graphSizes","{}")}function resizeGraphs(){let e=JSON.parse(this.localStorage.getItem("graphSizes")),t=document.documentElement.clientHeight,a=document.documentElement.clientWidth;for(var o in e){let r=e[o].height*t,n=e[o].width*a,i={height:r,width:n};Plotly.relayout(o,i)}}function swapNormalCharts(){var e=$(".carousel-container.active >>> .carousel-item.active")[0].id,t=e+"-chart",a=document.getElementById(t);a&&("none"==a.style.display?a.style.display="":a.style.display="none")}function swapProductCategoriesGraphs(){var e=$(".carousel-container.active >>> .carousel-item.active")[0].id;if("product-categories"==e){var t=e+"-chart-",a=document.getElementById(t+"1"),o=document.getElementById(t+"2"),r=document.getElementById(t+"3");a&&o&&r&&(""==a.style.display?(a.style.display="none",o.style.display="",r.style.display="none"):""==o.style.display?(a.style.display="none",o.style.display="none",r.style.display=""):""==r.style.display&&(a.style.display="",o.style.display="none",r.style.display="none"))}}function displayGraphError(e,t){t&&recordError(t,`Unable to display graph "${e}" - `);let a='\n    <div class="h-100 w-100 position-relative">\n      <div class="alert alert-danger graph-error h3" role="alert">\n        <i class="fas fa-exclamation-triangle"></i>\n        Error loading graph\n      </div>\n    </div>\n  ';const o=document.getElementById(e);o.innerHTML=a}function fixGraphMargins(){let e=JSON.parse(this.localStorage.getItem("graphSizes"));for(var t in e){let a=e[t].automargin;a&&Plotly.relayout(t,a)}}function updateTheme(e){try{if(gapi.auth2.getAuthInstance().isSignedIn.get()){var t=document.getElementsByClassName("carousel-item")[e],a=document.getElementsByTagName("body")[0];"dark"==t.getAttribute("theme")?(a.className="dark","platform"==t.id&&document.getElementsByClassName("demographics-table")[0].classList.add("table-dark")):a.className=""}}catch(e){console.error(e),recordError(e)}}function carouselNext(){$(".carousel-container.active > .carousel").carousel("next")}function carouselPrev(){$(".carousel-container.active > .carousel").carousel("prev")}function pauseDashboard(){let e=document.getElementById("pause-text"),t=document.getElementById("play-text");$("#dashboard-carousel").carousel("pause"),e.style.display="initial",t.style.display="none"}function playDashboard(){let e=document.getElementById("pause-text"),t=document.getElementById("play-text");$("#dashboard-carousel").carousel("cycle"),e.style.display="none",t.style.display="initial",setTimeout(function(){0!=t.offsetHeight&&$("#play-text").fadeOut()},2e3)}function toggleDashboardPause(){let e=document.getElementById("pause-text");0==e.offsetHeight?pauseDashboard():playDashboard()}function goToCarouselItem(e){$(".carousel-container.active > .carousel").carousel(e)}function swapCarousels(e){let t=$("#carousel-list"),a=t.children().length,o=$(".carousel-container.active"),r=parseInt(o.attr("carousel")),n=r+e,i=(n%a+a)%a,l=$(`.carousel-container[carousel='${i}']`);pauseDashboard(),o.removeClass("active"),l.addClass("active")}function addDotsToLoadingText(){const e=document.getElementById("loading-text");e.innerHTML.endsWith("...")||(e.innerHTML+="...")}function hideLoadingText(){const e=document.getElementById("loading-text");e.style.display="none"}function showLoadingText(){const e=document.getElementById("loading-text");e.style.display="initial"}function hideUpdatingText(){const e=document.getElementById("updating-text");e.style.display="none"}function showUpdatingText(){const e=document.getElementById("updating-text");e.style.display="initial"}localStorage.getItem("settings")||localStorage.setItem("settings",JSON.stringify(defaultSettings));var currentSettings=JSON.parse(localStorage.getItem("settings")),carouselInner=document.getElementById("main-carousel-inner"),indicatorList=document.getElementById("main-indicator-list");const cycleSpeed=1e3*currentSettings.cycleSpeed;var carousel=document.getElementById("dashboard-carousel");carousel.setAttribute("data-interval",cycleSpeed),carousel.setAttribute("data-pause","false");var categoryStatsCarousel=document.getElementById("category-stats-carousel");categoryStatsCarousel.setAttribute("data-interval",0),categoryStatsCarousel.setAttribute("data-pause","false");for(var enabledOrder=new Array(currentSettings.numEnabled),i=0;i<currentSettings.dashboards.length;i++){var dashboard=currentSettings.dashboards[i];dashboard.index>=0&&enabledOrder.splice(dashboard.index,1,{name:dashboard.name,icon:dashboard.icon,theme:dashboard.theme,title:dashboard.title})}for(i=0;i<enabledOrder.length;i++){var dashboardItem=document.getElementById(enabledOrder[i].name),indicator=document.getElementById("indicator").cloneNode();if(enabledOrder[i].name.includes("top-video-")){dashboardItem=document.getElementById("top-video-#").cloneNode(!0),dashboardText=dashboardItem.outerHTML,dashboardText=dashboardText.replace(/top-video-#/g,enabledOrder[i].name),dashboardText=dashboardText.replace(/TITLE PLACEHOLDER/,enabledOrder[i].title);var template=document.createElement("template");template.innerHTML=dashboardText,dashboardItem=template.content.firstChild}else dashboardItem.remove();document.createElement("div",dashboardItem.outerText),dashboardItem.setAttribute("theme",enabledOrder[i].theme),indicator.id="main-indicator-"+i,indicator.setAttribute("onclick","goToCarouselItem("+i+")"),indicator.className=enabledOrder[i].icon+" indicator",carouselInner.appendChild(dashboardItem),indicatorList.appendChild(indicator),0==i&&(dashboardItem.classList.add("active"),indicator.classList.add("active"))}document.getElementById("top-video-#").remove(),document.addEventListener("keyup",function(e){"ArrowLeft"==e.key?carouselPrev():"ArrowRight"==e.key?carouselNext():"ArrowDown"==e.key?swapCarousels(1):"ArrowUp"==e.key?swapCarousels(-1):32==e.which?toggleDashboardPause():"F2"==e.key?signIn():"A"==e.key.toUpperCase()?goToCarouselItem(9):"B"==e.key.toUpperCase()?goToCarouselItem(10):"C"==e.key.toUpperCase()?goToCarouselItem(11):"D"==e.key.toUpperCase()?goToCarouselItem(12):"E"==e.key.toUpperCase()?goToCarouselItem(13):"F"==e.key.toUpperCase()?goToCarouselItem(14):"N"==e.key.toUpperCase()?swapNormalCharts():"V"==e.key.toUpperCase()?swapProductCategoriesGraphs():isNaN(e.key)||32==e.which?"U"==e.key.toUpperCase()&&e.altKey&&gapi.auth2.getAuthInstance().isSignedIn.get()?updateDashboards():"L"==e.key.toUpperCase()&&e.altKey&&loadDashboards():e.ctrlKey||e.altKey?goToCarouselItem(parseInt(e.key)+9):goToCarouselItem(parseInt(e.key)-1)}),$(".carousel").on("slide.bs.carousel",function(e){var t=e.target.getAttribute("name"),a=t+"-indicator-",o=document.getElementById(a+e.from),r=document.getElementById(a+e.to);o.classList.remove("active"),r.classList.add("active"),window.setTimeout(function(){updateTheme(e.to);let t=document.getElementById("top-ten-thumbnail-wrapper");t.scrollLeft!=t.scrollWidth&&(t.scrollLeft=t.scrollWidth)},250)}),window.addEventListener("resize",function(){retry(resizeGraphs,5,5e3);let e=document.getElementById("top-ten");if(e.classList.contains("active")){let e=document.getElementById("top-ten-thumbnail-container");e.style.display="none",this.window.setTimeout(function(){e.style.display="flex"},500)}},!0);let isLoading=!1,isUpdating=!1;