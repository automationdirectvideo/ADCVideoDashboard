function getAllVideoStats(e){function t(e,t){let o=getTodaysDate(),r=[];for(let e=0;e<t.length;e+=50){const s=t.slice(e,e+50),n=s.join(","),i="video=="+n,a={dimensions:"video",endDate:o,filters:i,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"averageViewDuration,subscribersGained,subscribersLost",startDate:joinDate},l=gapi.client.youtubeAnalytics.reports.query(a).then(e=>{console.log("Video Request",e);let t={};const o=e.result.rows;for(let e=0;e<o.length;e++){const r=o[e],s=r[0],n=parseInt(r[1]),i=parseInt(r[2]),a=parseInt(r[3]),l=i-a;t[s]={avgViewDuration:n,subsGained:l}}return t}).catch(t=>{const o="Error in fetching analytics stats for video group"+` ${e} - ${e+49}: `;return console.log(o,t),recordError(t,o),o});r.push(l)}return Promise.all(r).then(t=>{console.log(t);let o={};t.forEach(e=>{o=Object.assign(o,e)});for(let t=0;t<e.length;t++){const r=e[t],s=r.videoId,n=e[t].duration;let i=0,a=0;o[s]&&(i=o[s].avgViewDuration,a=o[s].subsGained);let l=i/n;l>1&&(l=1),e[t].avgViewDuration=i,e[t].avgViewPercentage=l,e[t].subscribersGained=a}return e})}const o=lsGet("statsByVideoId");let r=[];for(let t=0;t<e.length;t+=50){const s=e.slice(t,t+50),n=s.join(","),i={part:"snippet,statistics,contentDetails",id:n},a=gapi.client.youtube.videos.list(i).then(e=>{console.log("Video Request",e);let t=[];const r=e.result.items;for(let e=0;e<r.length;e++){const s=r[e],n=s.id,i=s.statistics,a=s.contentDetails.duration,l=parseInt(isoDurationToSeconds(a)),c=parseInt(i.viewCount),d=parseInt(i.likeCount),u=parseInt(i.dislikeCount),h=parseInt(i.commentCount);let g=0,p=0;0!=c&&(g=d/c,p=u/c);const V=s.snippet.publishedAt.substr(0,10),w=getNumberDaysSince(V);let y=c;0!=w&&(y=c/w);const f=o[n].organic;t.push({videoId:n,views:c,likes:d,dislikes:u,likesPerView:g,dislikesPerView:p,comments:h,duration:l,daysSincePublished:w,avgViewsPerDay:y,publishDate:V,organic:f})}return t}).catch(e=>{const o="Error in fetching stats for video group"+` ${t} - ${t+49}: `;return console.log(o,e),recordError(e,o),o});r.push(a)}return Promise.all(r).then(o=>{console.log(o);let r=[].concat.apply([],o),s=t(r,e);console.log("getAllVideoStats()");let n=getVideoStrengthWeights();return Promise.all([s,n])}).then(e=>{allVideoStats=e[0];const t=e[1];allVideoStats=calcVideoStrength(allVideoStats,t),lsSet("allVideoStats",allVideoStats);let o=updateCategoryTotals(allVideoStats),r=calcCategoryStats(o,allVideoStats);const s=saveCategoryStatsToSheets(r),n=saveVideoStatsToSheets(allVideoStats),i=getTopTenVideosForCurrMonth();return Promise.all([s,n,i])})}function requestVideoViewsByYear(e,t){let o=[];const r=t+"-01-01",s=t+"-12-31";for(let t=0;t<e.length;t+=50){const n=e.slice(t,t+50),i=n.join(","),a="video=="+i,l={dimensions:"video",endDate:s,filters:a,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",startDate:r},c=gapi.client.youtubeAnalytics.reports.query(l).then(e=>e.result.rows).catch(e=>{const o="Error in fetching stats for video group"+` ${t} - ${t+49}: `;return console.error(o,e),recordError(e,o),o});o.push(c)}const n=Promise.all(o).then(e=>{const o=[].concat.apply([],e);console.log(`${t} Views by Video:`,o);const r=lsGet("statsByVideoId"),s=lsGet("categoryStats");let n={};for(let e=0;e<s.length;e++){const t=s[e].categoryId,o=s[e].shortName;n[t]={numVideos:0,shortName:o,views:0}}return o.forEach(e=>{const t=e[0],o=e[1],s=r[t].categories;for(let e=0;e<s.length;e++){const t=s[e],r=parseInt(n[t].views),i=parseInt(n[t].numVideos);n[t].views=r+o,n[t].numVideos=i+1}}),saveCategoryYearlyStatsToSheets(n,t)}).catch(e=>{const t="Unable to get video views by year: ";console.error(t,e),recordError(e,t)});return n}function requestVideoViews(e,t,o){let r=[];for(let s=0;s<e.length;s+=50){const n=e.slice(s,s+50),i=n.join(","),a="video=="+i,l={endDate:o,filters:a,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",startDate:t},c=gapi.client.youtubeAnalytics.reports.query(l).then(e=>{const t=e.result.rows[0][0];return t}).catch(e=>{const t="Error in fetching monthly views for video group"+` ${s} - ${s+49}: `;return console.error(t,e),recordError(e,t),t});r.push(c)}return Promise.all(r).then(e=>{const t=e.reduce((e,t)=>e+t,0);return t})}function getTopTenVideosForCurrMonth(){const[e,t,o]=getCurrMonth(),r=requestMostWatchedVideos(e,t,20,o);return r.then(e=>{const t={values:e},r=3+monthDiff(new Date(2010,6),new Date(o)),s="Top Ten Videos!A"+r;return updateSheetData("Stats",s,t).then(e=>"Updated Top Ten Video Sheet")})}function requestMostWatchedVideos(e,t,o,r){const s={dimensions:"video",endDate:t,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",maxResults:o,metrics:"views,estimatedMinutesWatched",sort:"-views",startDate:e};return gapi.client.youtubeAnalytics.reports.query(s).then(e=>{console.log("Most Watched Videos",e);const t=e.result.rows,o=lsGet("statsByVideoId");if(null==r)throw new Error("Month is undefined");for(var s=[[r]],n=0,i=1;i<=10;){const e=t[n][0],r=o[e].organic;r&&(s[0][i]=t[n][0],s[0][i+10]=t[n][1],s[0][i+20]=t[n][2],i++),n++}return s}).catch(e=>{const t="Error getting Most Watched Videos: ";console.error(t,e),recordError(e,t)})}function requestVideoDailyViews(e,t,o,r){const s="video=="+o,n={dimensions:"day",endDate:t,filters:s,ids:"channel==UCR5c2ZGLZY2FFbxZuSxzzJg",metrics:"views",sort:"day",startDate:e};return gapi.client.youtubeAnalytics.reports.query(n).then(e=>(console.log("Top Video Daily Views",e),displayVideoDailyViews(e,r),Promise.resolve(`Displayed Daily Views: ${o}`))).catch(e=>{const t=`Error getting daily views for video: ${o} - `;console.error(t,e),recordError(e,t);const s=getDashboardGraphIds(r),n=s.dailyViews;throw displayGraphError(n),new Error("Error in requestVideoDailyViews")})}async function getVideographerViewsForAllMonths(){isUpdating=!0;let e="2010-07-01";const t=new Date;let o=[];for(;t-new Date(e)>=3456e5;){o.push(e);let t=new Date(e);e=getYouTubeDateFormat(new Date(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate()))}try{let e=lsGet("videographers"),t=0;for(const r of o)console.log(r),e=await requestVideographerViewsForMonth(e,r),t++,t%10==0&&saveVideographerViewsToSheets(e),await delay(8e3);saveVideographerViewsToSheets(e)}catch(e){const t="Unable to get videographer monthly views for all months: ";recordError(e,t)}finally{isUpdating=!1}}function getVideographerViewsForCurrMonth(){const[e,t,o]=getCurrMonth(),r=lsGet("videographers");return requestVideographerViewsForMonth(r,e).then(e=>(console.log(e),saveVideographerViewsToSheets(e)))}function requestVideographerViewsForMonth(e,t){const o=new Date(t),r=getYouTubeDateFormat(new Date(o.getFullYear(),o.getMonth()+2,0)),s=t.substr(0,7);let n=[],i=[];for(const o in e)if(e.hasOwnProperty(o)){const s=e[o];for(const e in s)if(s.hasOwnProperty(e)){const a=s[e],l=a.videos;i.push({category:e,name:o}),n.push(requestVideoViews(l,t,r))}}return Promise.all(n).then(e=>{let t=lsGet("videographers");for(let o=0;o<i.length;o++){const r=i[o].name,n=i[o].category,a=e[o];t[r][n].monthlyViews||(t[r][n].monthlyViews={}),t[r][n].monthlyViews[s]=a}return lsSet("videographers",t),t}).catch(e=>{const t="Unable to get videographer views for month: "+`${s} - `;console.error(t,e),recordError(e,t)})}function getYearlyCategoryViews(e){const t=lsGet("statsByVideoId");let o=[];for(const r in t)if(t.hasOwnProperty(r)){const s=t[r].publishDate,n=s.substr(0,4);e>=n&&o.push(r)}return requestVideoViewsByYear(o,e)}