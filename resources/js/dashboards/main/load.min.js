function loadSignedIn(){addDotsToLoadingText();const e=document.getElementById("signin-modal-button"),t=document.getElementById("signout-modal-button"),a=document.getElementById("control-panel-button"),o=document.getElementById("menu-button-container");e.style.display="none",t.style.display="inline",a.style.display="inline",o.style.display="initial",initializeUpdater(),loadDashboards(),updateTheme(0),createShortcutListeners()}function loadSignedOut(){addDotsToLoadingText();const e=document.getElementById("signin-modal-button"),t=document.getElementById("signout-modal-button"),a=document.getElementById("control-panel-button");e.style.display="inline",t.style.display="none",a.style.display="none",initializeUpdater(),loadDashboards(),updateTheme(0)}function loadDashboards(){if(!isLoading&&!isUpdating){setLoadingStatus(!0);const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(showLoadingText(),resetGraphData(),e){let e=lsGet("categoryStats"),t=lsGet("realTimeStats");e&&t?loadDashboardsSignedIn():Promise.all([getBasicDashboardStats(),realTimeStatsCalls()]).then(e=>{loadDashboardsSignedIn()})}else loadDashboardsSignedOut()}}function loadDashboardsSignedIn(){const e=document.getElementsByClassName("carousel-inner")[0];let t=[];return e.children["intro-animation"]&&loadIntroAnimation(),e.children["video-strength"]&&loadVideoStrengthDashboard(),e.children["real-time-stats"]&&t.push(loadRealTimeStatsDashboard()),e.children.thumbnails&&t.push(loadThumbnailDashboard()),e.children.platform&&t.push(loadPlatformDashboard()),e.children["top-ten"]&&t.push(loadTopTenDashboard()),e.children.feedback&&t.push(loadUserFeedbackDashboard()),e.children["card-performance"]&&t.push(loadCardPerformanceDashboard()),e.children["product-categories"]&&t.push(displayTopCategoriesGraphOne()),t.push(loadTopVideoDashboards()),console.log("Starting Load Dashboards Requests"),Promise.all(t).then(e=>{console.log("Load Dashboards Complete",e)}).catch(e=>{const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{setLoadingStatus(!1),hideLoadingText()})}function loadDashboardsSignedOut(){const e=document.getElementsByClassName("carousel-inner")[0];let t=[];return e.children["intro-animation"]&&loadIntroAnimation(),getVideoStats().then(a=>(e.children["video-strength"]&&loadVideoStrengthDashboard(),e.children["real-time-stats"]&&t.push(loadRealTimeStatsDashboard()),e.children.thumbnails&&t.push(loadThumbnailDashboard()),e.children.platform&&t.push(loadChannelDemographics()),e.children["top-ten"]&&t.push(loadTopTenDashboard()),e.children.feedback&&t.push(loadUserFeedbackDashboard()),e.children["card-performance"]&&t.push(loadCardPerformanceDashboard()),t.push(loadGraphsFromSheets()),t.push(loadTopVideoStats()),console.log("Starting Load Dashboards Requests"),Promise.all(t).then(e=>{console.log("Load Dashboards Complete",e)}).catch(e=>{const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{setLoadingStatus(!1),hideLoadingText()})))}function initializeUpdater(){let e=new Date;e.setHours(0,0,0,0);const t=gapi.auth2.getAuthInstance().isSignedIn.get();var a=window.setInterval(()=>{const a=new Date;let o=Math.floor((a-e)/1e3);t?3600==o?recordUpdate("Reload Dashboards").then(e=>{window.location.reload()}):o%3600==0?updateDashboards():o%900==0&&loadDashboards():o%3600==0&&reloadIntroAnimation();const n=document.getElementsByClassName("carousel-inner")[0];n.children["real-time-stats"]&&updateRealTimeStats(o)},1e3);return a}function initializeCarousels(){var e=document.getElementById("main-carousel-inner"),t=document.getElementById("main-indicator-list"),a=document.getElementById("dashboard-carousel");a.setAttribute("data-ride","carousel"),a.setAttribute("data-interval",cycleSpeed),a.setAttribute("data-pause","false");for(var o=new Array(currentSettings.numEnabled),n=0;n<currentSettings.dashboards.length;n++){var r=currentSettings.dashboards[n];r.index>=0&&o.splice(r.index,1,{name:r.name,icon:r.icon,theme:r.theme,title:r.title})}for(n=0;n<o.length;n++){var s=document.getElementById(o[n].name),i=document.getElementById("indicator").cloneNode();if(o[n].name.includes("top-video-")){s=document.getElementById("top-video-#").cloneNode(!0),dashboardText=s.outerHTML,dashboardText=dashboardText.replace(/top-video-#/g,o[n].name),dashboardText=dashboardText.replace(/TITLE PLACEHOLDER/,o[n].title);var d=document.createElement("template");d.innerHTML=dashboardText,s=d.content.firstChild}else s.remove();document.createElement("div",s.outerText),s.setAttribute("theme",o[n].theme),i.id="main-indicator-"+n,i.setAttribute("onclick","goToCarouselItem("+n+")"),i.className=o[n].icon+" indicator",e.appendChild(s),t.appendChild(i),0==n&&(s.classList.add("active"),i.classList.add("active"))}document.getElementById("top-video-#").remove()}function createShortcutListeners(){document.addEventListener("keyup",function(e){isMenuOpen||"R"==e.key.toUpperCase()&&e.altKey&&(console.log("Reload Intro Animation"),reloadIntroAnimation())})}function loadIntroAnimation(){const e=document.getElementById("intro-img"),t=document.getElementById("intro-video");if(4!=t.readyState&&t.load(),t.paused){const a=t.play();void 0!==a&&a.then(a=>{e.style.display="none",t.style.display="initial"}).catch(a=>{document.getElementsByTagName("VIDEO")[0].play(),e.style.display="none",t.style.display="initial"})}}function reloadIntroAnimation(){const e=document.getElementById("intro-img"),t=document.getElementById("intro-video");t.style.display="none";const a=document.createElement("div"),o=document.getElementById("animation-container");e.style.display="",t.remove(),prependElement(o,a),a.outerHTML=t.outerHTML,loadIntroAnimation()}function loadPlatformDashboard(){const e=joinDate,t=getTodaysDate();let a=[];return a.push(requestChannelSearchTerms(e,t)),a.push(requestViewsByDeviceType(e,t)),a.push(requestViewsByTrafficSource(e,t)),a.push(requestViewsByState(e,t)),a.push(requestChannelDemographics(e,t)),a.push(requestWatchTimeBySubscribedStatus(e,t)),Promise.all(a).then(e=>(console.log("Platform Dashboard Calls Status:",e),"Displayed Platform Dashboard")).catch(e=>{const t="Error loading the Platform Dashboard: ";console.error(t,e),recordError(e,t)})}function loadChannelDemographics(){return requestSpreadsheetData("Stats","Channel Demographics").then(e=>{const t=JSON.parse(e[0][0]),a={result:{rows:t}};return displayChannelDemographics(a)})}function loadTopTenDashboard(){return requestSpreadsheetData("Stats","Top Ten Videos").then(e=>{const t=lsGet("statsByVideoId");let a="";for(let o=1;o<e.length;o++)for(let n=0;n<11;n++){const r=e[o];if(0==n)a+=`<div class="column-title"><h4>${r[n]}</h4></div>`;else{const s=r[n],i=numberWithCommas(parseInt(r[n+10])),d=numberWithCommas(parseInt(r[n+20]));let l="YouTube Video ID: "+s;if(t&&t[s]&&(l=t[s].title),l+=` | ${i} views & ${d} minutes watched`,a+=`\n              <div class="top-ten-thumbnail-holder column-thumbnail">\n                <a href="https://youtu.be/${s}" target="_blank"\n                    alt="${l}">\n                  <img class="top-ten-thumbnail"\n                      src="https://i.ytimg.com/vi/${s}/mqdefault.jpg" \n                      alt="thumbnail" title="${l}">`,1!=o){const t=n,r=e[o-1],i=r.indexOf(s);if(-1==i)a+='\n                  <span class="oi oi-arrow-thick-top arrow-green"></span>\n                  <span class="arrow-text-black">+</span>\n                ';else if(i!=t){const e=i-t;e<0?a+=`\n                    <span class="oi oi-arrow-thick-bottom arrow-red"></span>\n                    <span class="arrow-text-white">${Math.abs(e)}</span>\n                  `:e>0&&(a+=`\n                    <span class="oi oi-arrow-thick-top arrow-green"></span>\n                    <span class="arrow-text-black">${e}</span>\n                  `)}}a+="</a></div>"}}let o=document.getElementById("top-ten-thumbnail-container");o.innerHTML=a;let n=document.getElementById("top-ten-thumbnail-wrapper");return n.scrollLeft=n.scrollWidth,Promise.resolve("Displayed Top Ten Videos Dashboard")})}function loadUserFeedbackDashboard(){return requestSpreadsheetData("Input Data","User Feedback List").then(e=>{const t=lsGet("statsByVideoId");let a="";for(let o=1;o<e.length;o++){const n=e[o][0],r=e[o][1];let s="YouTube Video ID: "+n;t&&t[n]&&(s=t[n].title);const i=`\n          <div class="col-4">\n            <a href="https://youtu.be/${n}" target="_blank"\n                alt="${s}">\n              <img class="feedback-thumbnail" onload="thumbnailCheck($(this), true)"\n                  src="https://i.ytimg.com/vi/${n}/maxresdefault.jpg"\n                  alt="thumbnail" title="${s}">\n            </a>\n          </div>`,d=`\n          <div class="col-8">\n            <h1 class="feedback-text">"${r}"</h1>\n          </div>\n        `,l='<div class="col-12"><hr></div>';a+=o%2==0?d+i:i+d,o!=e.length-1&&(a+=l)}let o=document.getElementById("feedback-container");if(o.innerHTML=a,!autoScrollDivs.includes("feedback-wrapper")){const e=lsGet("settings");let t=-1,a=0;for(;-1==t&&a<=e.dashboards.length;){const o=e.dashboards[a];"top-ten"==o.name&&(t=o.scrollSpeed),a++}t=t<=0?0:Math.ceil(1e3/t),new AutoDivScroll("feedback-wrapper",t,1,1),autoScrollDivs.push("feedback-wrapper")}return Promise.resolve("Displayed User Feedback Dashboard")})}function loadCardPerformanceDashboard(){const e=getDashboardGraphIds("card-performance"),t=e.cardTeaser,a=e.card;return requestSpreadsheetData("Stats","Card Performance").then(e=>{e.shift();let o=[],n=[],r=[],s=[],i=[],d=e.length;const l=e[e.length-1];0==l[1]&&0==l[3]&&d--;for(let t=0;t<d;t++)o.push(e[t][0]),n.push(e[t][1]),r.push(100*e[t][2]),s.push(e[t][3]),i.push(100*e[t][4]);const c={x:o,y:n,type:"bar",hovertemplate:"%{y} Impressions<extra></extra>",name:"Card Impressions"},h={x:o,y:r,type:"scatter",hovertemplate:"%{y} Click Rate<extra></extra>",line:{width:4},name:"Card Click Rate",yaxis:"y2"},u={x:o,y:s,type:"bar",hovertemplate:"%{y:,g} Teaser Impressions<extra></extra>",name:"Card Teaser Impressions"},m={x:o,y:i,type:"scatter",hovertemplate:"%{y} Teaser Click Rate<extra></extra>",line:{width:4},name:"Card Teaser Click Rate",yaxis:"y2"},p=[c,h],g=[u,m],y=.4159,b=.9192,f=.9528,D=y*document.documentElement.clientHeight,v=b*document.documentElement.clientWidth,S=f*document.documentElement.clientWidth,T=Math.floor(.017*document.documentElement.clientHeight),I=Math.floor(.0094*document.documentElement.clientWidth),E=Math.floor(.013*document.documentElement.clientWidth),C=Math.floor(.0156*document.documentElement.clientWidth),w=Math.floor(.03*document.documentElement.clientWidth),x=Math.floor(.0104*document.documentElement.clientWidth),B=Math.floor(.01*document.documentElement.clientWidth),V={height:D,width:v,hoverlabel:{font:{size:B}},legend:{bgcolor:"#eeeeee",font:{size:T},x:1.1,y:.5},margin:{b:x,t:w},title:{font:{size:C},text:"Card Performance"},xaxis:{automargin:!0,fixedrange:!0,hoverformat:"%b %Y",tickformat:"%b<br>%Y",tickfont:{size:I},title:{font:{size:E},text:"Month"}},yaxis:{automargin:!0,fixedrange:!0,tickfont:{size:I},title:{font:{size:E},text:"Card Impressions"}},yaxis2:{automargin:!0,fixedrange:!0,showgrid:!1,tickfont:{size:I},title:{font:{size:E},text:"Card Click Rate"},overlaying:"y",side:"right",ticksuffix:"%",zeroline:!1}},L={displayModeBar:!1,scrollZoom:!1};let k=JSON.parse(JSON.stringify(V));k.title.text="Card Teaser Performance",k.yaxis.title.text="Card Teaser Impressions",k.width=S;let M=0;try{createGraph(t,g,k,L,y,b)}catch(e){M++,displayGraphError(t,e)}try{createGraph(a,p,V,L,y,b)}catch(e){M++,displayGraphError(a,e)}return M>0?Promise.resolve("Error Displaying Card Performance Dashboard"):Promise.resolve("Displayed Card Performance Dashboard")}).catch(e=>{displayGraphError(t,e),displayGraphError(a,e)})}function loadRealTimeStatsDashboard(){const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(!e)return requestSpreadsheetData("Stats","Real Time Stats").then(e=>{let t={};const a=getColumnHeaders(e);for(let o=1;o<e.length;o++){const n=e[o],r=n[a["Time Range"]],s=n[a.Views],i=n[a["Estimated Minutes Watched"]],d=n[a["Average View Duration"]],l=n[a["Subscribers Gained"]];t[r]={views:parseInt(s),estimatedMinutesWatched:parseInt(i),averageViewDuration:parseInt(d),netSubscribersGained:parseInt(l)}}return lsSet("realTimeStats",t),displayRealTimeStats(t)});try{return displayRealTimeStats()}catch(e){return recordError(e),realTimeStatsCalls()}}function loadGraphsFromSheets(){return requestSpreadsheetData("Stats","Graph Data").then(e=>{let t=0;const a=getColumnHeaders(e);for(let o=1;o<e.length;o++){const n=e[o],r=n[a["Graph ID"]],s=JSON.parse(n[a.Data]),i=JSON.parse(n[a.Layout]),d=JSON.parse(n[a.Config]),l=parseFloat(n[a["Graph Height"]]),c=parseFloat(n[a["Graph Width"]]),h=JSON.parse(n[a.Automargin]);try{null!=document.getElementById(r)&&(Plotly.newPlot(r,s,i,d),"None"!=h?recordGraphSize(r,l,c,h):recordGraphSize(r,l,c))}catch(e){console.error(e),recordError(e),displayGraphError(r),t++}}return Promise.resolve("Displayed Graphs From Sheets with "+t+" errors")})}function loadTopVideoStats(){return requestSpreadsheetData("Stats","Top Video Stats").then(e=>{const t=getColumnHeaders(e);let a={},o=[];for(let n=1;n<e.length;n++){const r=e[n],s=r[t["Video ID"]],i=r[t["Dashboard ID"]],d=r[t.Title],l=r[t.Duration],c=r[t["Publish Date"]],h=r[t.Thumbnail],u=r[t.Views],m=r[t["Subscribers Gained"]],p=r[t["Average View Duration"]],g=r[t["Estimated Minutes Watched"]],y=r[t.Comments],b=parseInt(r[t.Likes]),f=parseInt(r[t.Dislikes]);try{document.getElementById(i+"-title").innerHTML=d,document.getElementById(i+"-duration").innerHTML="Duration: "+secondsToDuration(l),document.getElementById(i+"-duration-seconds").innerHTML=l,document.getElementById(i+"-publish-date").innerHTML="Published: "+c,document.getElementById(i+"-thumbnail").innerHTML=h;const e=[s,u,y,b,f,g,p,m,0];o.push(e),a[s]=i}catch(e){const t=`Dashboard "${i}" does not exist - `;console.error(t,e),recordError(e,t)}}const n={result:{rows:o}};return displayVideoBasicStats(n,a),Promise.resolve("Displayed Top Video Dashboards")})}function loadThumbnailDashboard(){const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(e){const e=displayUploadThumbnails(),t={part:"statistics",forUsername:"automationdirect"},a=gapi.client.youtube.channels.list(t).then(e=>{const t=e.result.items[0].statistics.videoCount;document.getElementById("num-videos").innerText=t}).catch(e=>{const t="Unable to get number of channel videos: ";console.error(t,e),recordError(e,t)});return Promise.all([a,e])}return displayUploadThumbnails()}function loadTopVideoDashboards(){const e=document.getElementsByClassName("carousel-inner")[0],t=getTodaysDate();let a=[],o={};if(e.children["top-video-1"]){const e=getTopVideoByCategory("B","views")[0];null!=e&&(o[e]="top-video-1",a.push(e))}if(e.children["top-video-2"]){const e=getTopVideoByCategory("C","views")[0];null!=e&&(o[e]="top-video-2",a.push(e))}if(e.children["top-video-3"]){const e=getTopVideoByCategory("D","views")[0];null!=e&&(o[e]="top-video-3",a.push(e))}if(e.children["top-video-4"]){const e=getTopVideoByCategory("F","views")[0];null!=e&&(o[e]="top-video-4",a.push(e))}if(e.children["top-video-5"]){const e=getTopVideoByCategory("H","views")[0];null!=e&&(o[e]="top-video-5",a.push(e))}if(e.children["top-video-6"]){const e=getTopVideoByCategory("I","views")[0];null!=e&&(o[e]="top-video-6",a.push(e))}if(0==a.length)return null;const n=a.join(",");return topVideoCalls(joinDate,t,n,o)}function loadVideoStrengthDashboard(){const e=lsGet("statsByVideoId"),t=lsGet("allVideoStats");t.sort(sortVideosByStrength);let a=20,o="",n=[],r=0,s=0;for(;r<t.length&&s<a;){const i=t[r],d=i.videoId,l=e[d].organic;if(l){s++;const t=Math.round(100*i.strength)/100;let r="YouTube Video ID: "+d,l=`video-strength-bars-${s}`;n.push({videoStats:i,graphId:l}),e&&e[d]&&(r=e[d].title),o+=`\n        <div class="col-1">\n          <h1 style="font-size:5rem;">${s}.</h1>\n        </div>\n        <div class="col-3">\n          <a href="https://youtu.be/${d}" target="_blank"\n              alt="${r}">\n            <img class="feedback-thumbnail"\n                onload="thumbnailCheck($(this), true)"\n                src="https://i.ytimg.com/vi/${d}/maxresdefault.jpg"\n                alt="thumbnail" title="${r}">\n          </a>\n        </div>\n        <div class="col-4">\n          <h1 class="video-strength-title">${r}</h1>\n          <br>\n          <h2 class="video-strength-value">Strength: ${t}</h2>\n        </div>\n        <div class="col-4">\n          <div class="h-100 w-100 graph-container" id="${l}"></div>\n        </div>\n      `;const c='\n        <div class="col-12">\n          <hr style="border-top:0.25rem solid rgba(0,0,0,.3);">\n        </div>\n      ';s!=a&&(o+=c)}r++}let i=document.getElementById("video-strength-container");if(i.innerHTML=o,!autoScrollDivs.includes("video-strength-wrapper")){let e=lsGet("settings"),t=-1,a=0;for(;-1==t&&a<=e.dashboards.length;){let o=e.dashboards[a];"video-strength"==o.name&&(t=o.scrollSpeed),a++}t=t<=0?0:Math.ceil(1e3/t),new AutoDivScroll("video-strength-wrapper",t,1,1),autoScrollDivs.push("video-strength-wrapper")}if(gapi.auth2.getAuthInstance().isSignedIn.get())if(void 0===t[0].z)reloadVideoStrengthDashboard();else for(let e=0;e<n.length;e++){const t=n[e];displayVideoStrengthBars(t.videoStats,t.graphId)}}function reloadVideoStrengthDashboard(){return getVideoStrengthWeights().then(e=>{try{const t=lsGet("allVideoStats");let a=calcVideoStrength(t,e);lsSet("allVideoStats",a),loadVideoStrengthDashboard()}catch(e){const t="Unable to recalculate video strengths";return console.error(t,e),recordError(e,t),t}})}function updateDashboards(){if(!isLoading&&!isUpdating){setUpdatingStatus(!0),showUpdatingText();const e=new Date;let t=[];if(0==e.getMonth()&&e.getDate()>=10&&e.getDate<=20){const a=e.getFullYear()-1;t.push(getYearlyCategoryViews(a))}return t.push(getCardPerformanceForCurrMonth()),t.push(getVideographerViewsForCurrMonth()),t.push(realTimeStatsCalls()),t.push(updateVideoAndCategoryStats()),reloadIntroAnimation(),Promise.all(t).then(e=>(console.log("Update Dashboards Complete",e),recordUpdate("Dashboards Updated"),hideUpdatingText(),setUpdatingStatus(!1),loadDashboards())).catch(e=>{recordUpdate("Update Failed");const t="Error occurred updating dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{hideUpdatingText(),setUpdatingStatus(!1)})}}$(".carousel").on("slide.bs.carousel",function(e){window.setTimeout(function(){updateTheme(e.to);let t=document.getElementById("top-ten-thumbnail-wrapper");t.scrollLeft!=t.scrollWidth&&(t.scrollLeft=t.scrollWidth)},250)}),window.addEventListener("resize",function(){let e=document.getElementById("top-ten");if(e.classList.contains("active")){let e=document.getElementById("top-ten-thumbnail-container");e.style.display="none",this.window.setTimeout(function(){e.style.display="flex"},500)}},!0);