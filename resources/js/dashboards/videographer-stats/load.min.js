function loadSignedIn(){addDotsToLoadingText();const e=document.getElementById("home-button"),t=document.getElementById("control-panel-button"),a=document.getElementById("menu-button-container");e.style.display="inline",t.style.display="inline",a.style.display="initial",initializeUpdater(),loadDashboards(),updateTheme(0),createShortcutListeners()}function loadSignedOut(){createSignInModal("dashboards");const e=document.getElementById("authorize-button");e.onclick=handleAuthClick,$("#signinModal").modal({backdrop:"static",keyboard:!1})}function loadDashboards(){if(!isLoading&&!isUpdating){setLoadingStatus(!0);const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(showLoadingText(),resetGraphData(),e){let e=lsGet("categoryStats");e?loadDashboardsSignedIn():getBasicDashboardStats().then(e=>{loadDashboardsSignedIn()})}}}function loadDashboardsSignedIn(){console.log("Starting Load Dashboards Requests");try{loadVideographerDashboards(),console.log("Load Dashboards Complete")}catch(e){const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}finally{setLoadingStatus(!1),hideLoadingText()}}function initializeUpdater(){let e=new Date;e.setHours(0,0,0,0);const t=gapi.auth2.getAuthInstance().isSignedIn.get();var a=window.setInterval(()=>{const a=new Date;let r=Math.floor((a-e)/1e3);t&&(3600==r?recordUpdate("Reload Dashboards").then(e=>{window.location.reload()}):r%900==0&&loadDashboards())},1e3);return a}function initializeCarousels(){const e=document.getElementById("videographer-carousel");e.setAttribute("data-ride","carousel"),e.setAttribute("data-interval",cycleSpeed),e.setAttribute("data-pause","false"),createVideographerStatsDashboards()}function updateDashboards(){if(!isLoading&&!isUpdating){setUpdatingStatus(!0),showUpdatingText();let e=[];return e.push(getVideographerViewsForCurrMonth()),e.push(updateVideoAndCategoryStats()),Promise.all(e).then(e=>(console.log("Update Dashboards Complete",e),recordUpdate("Dashboards Updated"),hideUpdatingText(),setUpdatingStatus(!1),loadDashboards())).catch(e=>{recordUpdate("Update Failed");const t="Error occurred updating dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{hideUpdatingText(),setUpdatingStatus(!1)})}}function createShortcutListeners(){document.addEventListener("keyup",function(e){"H"==e.key.toUpperCase()&&e.altKey&&gapi.auth2.getAuthInstance().isSignedIn.get()?window.location="index.html":isMenuOpen||"V"==e.key.toUpperCase()&&swapDashboardGraphs()})}function swapDashboardGraphs(e){const t=$(".carousel-container.active >>> .carousel-item.active")[0].id;let a,r,o,s,d,i;if(0==t.indexOf("videographer")){let e;"videographer-avg-views"==t?e=getDashboardGraphIds("videographerGraphs").avgViews:"videographer-cumulative-videos"==t?e=getDashboardGraphIds("videographerGraphs").cumulativeVideos:"videographer-yearly-videos"==t?e=getDashboardGraphIds("videographerGraphs").yearlyVideos:"videographer-cumulative-views"==t?e=getDashboardGraphIds("videographerGraphs").cumulativeViews:"videographer-monthly-views"==t&&(e=getDashboardGraphIds("videographerGraphs").monthlyViews),a=document.getElementById(e.all),r=document.getElementById(e.organic),o=document.getElementById(e.notOrganic),s=document.getElementById(e.all.replace("-graph-","-btn-")),d=document.getElementById(e.organic.replace("-graph-","-btn-")),i=document.getElementById(e.notOrganic.replace("-graph-","-btn-"))}if(a&&r&&o)2==e||""==a.style.display&&!e?(a.style.display="none",r.style.display="",o.style.display="none",s.disabled="",d.disabled="disabled",i.disabled=""):3==e||""==r.style.display&&!e?(a.style.display="none",r.style.display="none",o.style.display="",s.disabled="",d.disabled="",i.disabled="disabled"):(1==e||""==o.style.display&&!e)&&(a.style.display="",r.style.display="none",o.style.display="none",s.disabled="disabled",d.disabled="",i.disabled="");else if(0==t.indexOf("vstat")){const e=document.getElementById(t),a=e.querySelector(".vstats-grid-container.active-grid");let r=a.nextElementSibling;if(null==r){const e=a.parentElement;r=e.firstElementChild}a.classList.remove("active-grid"),r.classList.add("active-grid")}}function loadVideographerDashboards(){try{let e=calcVideographerStats();displayVideographerMonthlyVideos(e);const t=requestVideographerAvgViews(e,getDateFromDaysAgo(34),getDateFromDaysAgo(4)).then(e=>{displayVideographerAvgViews(e)}).catch(e=>{const t=getDashboardGraphIds("videographerGraphs").avgViews;for(const e in t)if(t.hasOwnProperty(e)){const a=t[e];displayGraphError(a)}recordError(e,"Unable to display videographer average views graphs - ")}),a=getVideographerMonthlyViews(e).then(e=>{displayVideographerMonthlyViews(e)}).catch(e=>{const t=[getDashboardGraphIds("videographerGraphs").cumulativeViews,getDashboardGraphIds("videographerGraphs").monthlyViews];t.forEach(e=>{for(const t in e)if(e.hasOwnProperty(t)){const a=e[t];displayGraphError(a)}}),recordError(e,"Unable to display videographer monthly views graphs - ")}),r=requestVideographerEngagementStats(e,getDateFromDaysAgo(34),getDateFromDaysAgo(4)),o=requestVideographerEngagementStats(e);Promise.all([t,a,r,o]).then(e=>{displayVideographerStats(),saveVideographerStatsToSheets()})}catch(e){const t=[getDashboardGraphIds("videographerGraphs").avgViews,getDashboardGraphIds("videographerGraphs").cumulativeVideos,getDashboardGraphIds("videographerGraphs").cumulativeViews,getDashboardGraphIds("videographerGraphs").yearlyVideos,getDashboardGraphIds("videographerGraphs").monthlyViews];t.forEach(e=>{for(const t in e)if(e.hasOwnProperty(t)){const a=e[t];displayGraphError(a)}}),recordError(e,"Unable to load videographer dashboards")}}function createVideographerStatsDashboards(){const e=document.getElementById("videographer-carousel-inner"),t=document.getElementById("videographer-indicator-list"),a=["Shane C","Rick F","Tim W"],r={all:"All Videos",organic:"Organic Videos",notOrganic:"Not Organic Videos"};let o=e.childElementCount;a.forEach(a=>{const s="vstats-"+a.replace(" ","*"),d="vstats-overall-"+a.replace(" ","*");let i=document.getElementById("vstats-#").cloneNode(!0),n=i.outerHTML,l="",h="";for(const e in r)if(r.hasOwnProperty(e)){const t=r[e],o=document.getElementById("vstats-#-@-grid").cloneNode(!0);"all"==e&&o.classList.add("active-grid");let s=o.outerHTML;s=s.replace(/@/g,e),s=s.replace(/\*Name\*/g,a),s=s.replace(/\*Category\*/g,t),l+=s;const d=document.getElementById("vstats-overall-#-@-grid").cloneNode(!0);let i=d.outerHTML;i=i.replace(/@/g,e),i=i.replace(/\*Name\*/g,a),i=i.replace(/\*Category\*/g,t),h+=i}n=n.replace(/<div>MAIN GRID PLACEHOLDER<\/div>/,l),n=n.replace(/<div>OVERALL GRID PLACEHOLDER<\/div>/,h),n=n.replace(/vstats-#/g,s),n=n.replace(/vstats-overall-#/g,d);let c=document.createElement("template");c.innerHTML=n,i=c.content.firstChild,document.createElement("div",i.outerText),i.setAttribute("theme","light");const g=document.getElementById("indicator").cloneNode();g.id="videographer-indicator-"+o,g.setAttribute("onclick",`goToCarouselItem(${o})`),g.setAttribute("data-target","#videographer-carousel"),g.className="fas fa-play-circle indicator",e.appendChild(i),t.appendChild(g),o++})}function getVideographerMonthlyViews(){return requestSpreadsheetData("Stats","Videographer Monthly Views").then(e=>{const t=getColumnHeaders(e);let a={};e[0].forEach(e=>{"Month"!=e&&(a[e]={})});for(let r=1;r<e.length;r++){const o=e[r],s=o[t.Month];e[0].forEach(e=>{"Month"!=e&&(a[e][s]=parseInt(o[t[e]]))})}let r=lsGet("videographers");for(const e in a)if(a.hasOwnProperty(e)){const t=a[e],o=e.indexOf("-"),s=e.substring(0,o),d=e.substring(o+1);r[s][d].monthlyViews=t}return lsSet("videographers",r),r})}