function loadSignedIn(){addDotsToLoadingText();const e=document.getElementById("home-button"),t=document.getElementById("control-panel-button"),a=document.getElementById("menu-button-container");e.style.display="inline",t.style.display="inline",a.style.display="initial",initializeUpdater(),loadDashboards(),updateTheme(0),createShortcutListeners()}function loadSignedOut(){createSignInModal("dashboards");const e=document.getElementById("authorize-button");e.onclick=handleAuthClick,$("#signinModal").modal({backdrop:"static",keyboard:!1})}function loadDashboards(){if(!isLoading&&!isUpdating){setLoadingStatus(!0);const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(showLoadingText(),resetGraphData(),e){let e=lsGet("categoryStats");e?loadDashboardsSignedIn():getBasicDashboardStats().then(e=>{loadDashboardsSignedIn()})}}}function loadDashboardsSignedIn(){console.log("Starting Load Dashboards Requests");try{loadVideographerDashboards(),console.log("Load Dashboards Complete")}catch(e){const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}finally{setLoadingStatus(!1),hideLoadingText()}}function initializeUpdater(){let e=new Date;e.setHours(0,0,0,0);const t=gapi.auth2.getAuthInstance().isSignedIn.get();var a=window.setInterval(()=>{const a=new Date;let r=Math.floor((a-e)/1e3);t&&(3600==r?recordUpdate("Reload Dashboards").then(e=>{window.location.reload()}):r%900==0&&loadDashboards())},1e3);return a}function initializeCarousels(){const e=document.getElementById("videographer-carousel");e.setAttribute("data-ride","carousel"),e.setAttribute("data-interval",cycleSpeed),e.setAttribute("data-pause","false"),createVideographerStatsDashboards()}function updateDashboards(){if(!isLoading&&!isUpdating){setUpdatingStatus(!0),showUpdatingText();let e=[];return e.push(getVideographerViewsForCurrMonth()),e.push(updateVideoAndCategoryStats()),Promise.all(e).then(e=>(console.log("Update Dashboards Complete",e),recordUpdate("Dashboards Updated"),hideUpdatingText(),setUpdatingStatus(!1),loadDashboards())).catch(e=>{recordUpdate("Update Failed");const t="Error occurred updating dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{hideUpdatingText(),setUpdatingStatus(!1)})}}function createShortcutListeners(){document.addEventListener("keyup",function(e){"H"==e.key.toUpperCase()&&e.altKey&&gapi.auth2.getAuthInstance().isSignedIn.get()?window.location="index.html":isMenuOpen||"V"==e.key.toUpperCase()&&swapDashboardGraphs()})}function swapDashboardGraphs(){const e=$(".carousel-container.active >>> .carousel-item.active")[0].id;let t,a,r;if(0==e.indexOf("videographer")){let o;"videographer-avg-views"==e?o=getDashboardGraphIds("videographerGraphs").avgViews:"videographer-cumulative-videos"==e?o=getDashboardGraphIds("videographerGraphs").cumulativeVideos:"videographer-monthly-videos"==e?o=getDashboardGraphIds("videographerGraphs").monthlyVideos:"videographer-cumulative-views"==e?o=getDashboardGraphIds("videographerGraphs").cumulativeViews:"videographer-monthly-views"==e&&(o=getDashboardGraphIds("videographerGraphs").monthlyViews),t=document.getElementById(o.all),a=document.getElementById(o.organic),r=document.getElementById(o.notOrganic)}if(t&&a&&r)""==t.style.display?(t.style.display="none",a.style.display="",r.style.display="none"):""==a.style.display?(t.style.display="none",a.style.display="none",r.style.display=""):""==r.style.display&&(t.style.display="",a.style.display="none",r.style.display="none");else if(0==e.indexOf("vstat")){const t=document.getElementById(e),a=t.querySelector(".vstats-grid-container.active-grid");let r=a.nextElementSibling;if(null==r){const e=a.parentElement;r=e.firstElementChild}a.classList.remove("active-grid"),r.classList.add("active-grid")}}function loadVideographerDashboards(){try{let e=calcVideographerStats();displayVideographerMonthlyVideos(e);const t=requestVideographerAvgViews(e,getDateFromDaysAgo(34),getDateFromDaysAgo(4)).then(e=>{displayVideographerAvgViews(e)}).catch(e=>{const t=getDashboardGraphIds("videographerGraphs").avgViews;for(const e in t)if(t.hasOwnProperty(e)){const a=t[e];displayGraphError(a)}recordError(e,"Unable to display videographer average views graphs - ")}),a=getVideographerMonthlyViews(e).then(e=>{displayVideographerMonthlyViews(e)}).catch(e=>{const t=[getDashboardGraphIds("videographerGraphs").cumulativeViews,getDashboardGraphIds("videographerGraphs").monthlyViews];t.forEach(e=>{for(const t in e)if(e.hasOwnProperty(t)){const a=e[t];displayGraphError(a)}}),recordError(e,"Unable to display videographer monthly views graphs - ")}),r=requestVideographerEngagementStats(e,getDateFromDaysAgo(34),getDateFromDaysAgo(4)),o=requestVideographerEngagementStats(e);Promise.all([t,a,r,o]).then(e=>{displayVideographerStats(),saveVideographerStatsToSheets()})}catch(e){const t=[getDashboardGraphIds("videographerGraphs").avgViews,getDashboardGraphIds("videographerGraphs").cumulativeVideos,getDashboardGraphIds("videographerGraphs").cumulativeViews,getDashboardGraphIds("videographerGraphs").monthlyVideos,getDashboardGraphIds("videographerGraphs").monthlyViews];t.forEach(e=>{for(const t in e)if(e.hasOwnProperty(t)){const a=e[t];displayGraphError(a)}}),recordError(e,"Unable to load videographer dashboards")}}function createVideographerStatsDashboards(){const e=document.getElementById("videographer-carousel-inner"),t=document.getElementById("videographer-indicator-list"),a=["Shane C","Rick F","Tim W"],r={all:"All Videos",organic:"Organic Videos",notOrganic:"Not Organic Videos"};let o=e.childElementCount;a.forEach(a=>{const s="vstats-"+a.replace(" ","*"),n="vstats-overall-"+a.replace(" ","*");let i=document.getElementById("vstats-#").cloneNode(!0),d=i.outerHTML,l="",h="";for(const e in r)if(r.hasOwnProperty(e)){const t=r[e],o=document.getElementById("vstats-#-@-grid").cloneNode(!0);"all"==e&&o.classList.add("active-grid");let s=o.outerHTML;s=s.replace(/@/g,e),s=s.replace(/\*Name\*/g,a),s=s.replace(/\*Category\*/g,t),l+=s;const n=document.getElementById("vstats-overall-#-@-grid").cloneNode(!0);let i=n.outerHTML;i=i.replace(/@/g,e),i=i.replace(/\*Name\*/g,a),i=i.replace(/\*Category\*/g,t),h+=i}d=d.replace(/<div>MAIN GRID PLACEHOLDER<\/div>/,l),d=d.replace(/<div>OVERALL GRID PLACEHOLDER<\/div>/,h),d=d.replace(/vstats-#/g,s),d=d.replace(/vstats-overall-#/g,n);let c=document.createElement("template");c.innerHTML=d,i=c.content.firstChild,document.createElement("div",i.outerText),i.setAttribute("theme","light");const g=document.getElementById("indicator").cloneNode();g.id="videographer-indicator-"+o,g.setAttribute("onclick",`goToCarouselItem(${o})`),g.setAttribute("data-target","#videographer-carousel"),g.className="fas fa-play-circle indicator",e.appendChild(i),t.appendChild(g),o++})}function calcVideographerVideosByMonth(e){const t=lsGet("statsByVideoId"),a=new Date,r=30;for(const o in e)if(e.hasOwnProperty(o)){const s=e[o];for(const e in s)if(s.hasOwnProperty(e)){const o=s[e];let n={},i=0;const d=o.videos;d.forEach(e=>{const o=t[e].publishDate,s=o.substr(0,7);null==n[s]&&(n[s]=0),n[s]+=1,a-new Date(o)<=864e5*r&&i++});const l=getMonthsSince(2010,7);l.forEach(e=>{null==n[e]&&(n[e]=0)}),o.monthlyVideos=n,o.numVideosLastXDays=i}}return e}function getVideographerMonthlyViews(){return requestSpreadsheetData("Stats","Videographer Monthly Views").then(e=>{const t=getColumnHeaders(e);let a={};e[0].forEach(e=>{"Month"!=e&&(a[e]={})});for(let r=1;r<e.length;r++){const o=e[r],s=o[t.Month];e[0].forEach(e=>{"Month"!=e&&(a[e][s]=parseInt(o[t[e]]))})}let r=lsGet("videographers");for(const e in a)if(a.hasOwnProperty(e)){const t=a[e],o=e.indexOf("-"),s=e.substring(0,o),n=e.substring(o+1);r[s][n].monthlyViews=t}return lsSet("videographers",r),r})}