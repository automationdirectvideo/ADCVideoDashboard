function loadSignedIn(){addDotsToLoadingText();const e=document.getElementById("home-button"),t=document.getElementById("control-panel-button"),a=document.getElementById("menu-button-container");e.style.display="inline",t.style.display="inline",a.style.display="initial",initializeUpdater(),loadDashboards(),updateTheme(0),createShortcutListeners()}function loadSignedOut(){createSignInModal("dashboards");const e=document.getElementById("authorize-button");e.onclick=handleAuthClick,$("#signinModal").modal({backdrop:"static",keyboard:!1})}function loadDashboards(){if(!isLoading&&!isUpdating){setLoadingStatus(!0);const e=gapi.auth2.getAuthInstance().isSignedIn.get();if(showLoadingText(),resetGraphData(),e){let e=lsGet("categoryStats");e?loadDashboardsSignedIn():getBasicDashboardStats().then(e=>{loadDashboardsSignedIn()})}}}function loadDashboardsSignedIn(){let e=[];return e.push(loadProductCategoriesDashboard()),e.push(loadCategoryCharts()),console.log("Starting Load Dashboards Requests"),Promise.all(e).then(e=>{console.log("Load Dashboards Complete",e)}).catch(e=>{const t="Error occurred loading dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{setLoadingStatus(!1),hideLoadingText()})}function initializeUpdater(){let e=new Date;e.setHours(0,0,0,0);const t=gapi.auth2.getAuthInstance().isSignedIn.get();var a=window.setInterval(()=>{const a=new Date;let o=Math.floor((a-e)/1e3);t&&(3600==o?recordUpdate("Reload Dashboards").then(e=>{window.location.reload()}):o%900==0&&loadDashboards())},1e3);return a}function initializeCarousels(){const e=document.getElementById("category-stats-carousel");e.setAttribute("data-ride","carousel"),e.setAttribute("data-interval",cycleSpeed),e.setAttribute("data-pause","false");const t=document.querySelectorAll(".normalize-btn");t.forEach(e=>{e.addEventListener("click",swapNormalCharts)})}function updateDashboards(){if(!isLoading&&!isUpdating){setUpdatingStatus(!0),showUpdatingText();const e=new Date;let t=[];if(0==e.getMonth()&&e.getDate()>=10&&e.getDate<=20){const a=e.getFullYear()-1;t.push(getYearlyCategoryViews(a))}return t.push(updateVideoAndCategoryStats()),Promise.all(t).then(e=>(console.log("Update Dashboards Complete",e),recordUpdate("Dashboards Updated"),hideUpdatingText(),setUpdatingStatus(!1),loadDashboards())).catch(e=>{recordUpdate("Update Failed");const t="Error occurred updating dashboards: ";console.error(t,e),recordError(e,t)}).finally(e=>{hideUpdatingText(),setUpdatingStatus(!1)})}}function createShortcutListeners(){document.addEventListener("keyup",function(e){"H"==e.key.toUpperCase()&&e.altKey&&gapi.auth2.getAuthInstance().isSignedIn.get()?window.location="index.html":isMenuOpen||"N"!=e.key.toUpperCase()&&"V"!=e.key.toUpperCase()||swapNormalCharts()})}function loadCategoryCharts(){return requestSpreadsheetData("Stats","Category Views By Year").then(e=>{let t=lsGet("categoryStats"),a={},o=[];for(var n=1;n<e.length;n+=2){let t=e[n][0].substr(0,4);o.push(t)}a.years=o;let r=new Array(o.length).fill(0);for(var s=1;s<e[0].length;s++){let o=e[0][s],i=!1;for(var d=0;0==i&&d<t.length;)t[d].categoryId==o&&(i=t[d]),d++;let l=i.root;if(l&&"A"!=o){let t=[],d=[],l=[],c=[];for(n=1;n<e.length;n+=2){let a=parseInt(e[n][s]),o=parseInt(e[n+1][s]);t.push(a);let i=0;1!=n&&(i=parseInt(l[(n-1)/2-1]));let u=i+a;l.push(u);let g=0,h=0;0!=o&&(g=(a/o).toFixed(0),h=(u/o).toFixed(0)),d.push(g),c.push(h),r[(n-1)/2]+=parseInt(a)}a[o]={name:i.shortName,viewTrace:t,avgViewTrace:d,cumulativeViews:l,cumulativeAvgViewTrace:c}}}return a.totals=r,displayCategoryViewsAreaCharts(a)}).catch(e=>{recordError(e);const t=getDashboardGraphIds("categoryGraphs");t.forEach(e=>{displayGraphError(e)})})}function loadProductCategoriesDashboard(){return displayTopCategoriesGraphOne(),displayTopCategoriesGraphTwo(),displayTopCategoriesGraphThree(),Promise.resolve("Displayed Product Categories Dashboard")}function hideCategoryStrengthGraph(){document.getElementById("category-graph-container").style.display="none"}function showCategoryStrengthGraph(){document.getElementById("category-graph-container").style.display="",document.getElementById("popup-graph-loading").style.display="",document.getElementById("category-strength-popup-graph").style.display="none"}function swapNormalCharts(){const e=$(".carousel-container.active >>> .carousel-item.active")[0].id,t=document.getElementById(`${e}-chart`),a=document.getElementById(`${e}-normalize`);t&&("none"==t.style.display?(t.style.display="",a.innerHTML='<i class="fas fa-expand-alt button-icon"></i>Normalize'):(t.style.display="none",a.innerHTML='<i class="fas fa-compress-alt button-icon"></i>Denormalize'))}